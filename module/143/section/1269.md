# Enumeración acreditada: de Linux

---

Ahora que hemos adquirido un punto de apoyo en el dominio, es hora de profundizar utilizando nuestras credenciales de usuario de dominio de bajo privilegio. Dado que tenemos una idea general sobre la base de usuarios y las máquinas del dominio, es hora de enumerar el dominio en profundidad. Estamos interesados ​​en información sobre los atributos de usuario y computadora de dominio, membresía grupal, objetos de política grupal, permisos, ACL, fideicomisos y más. Tenemos varias opciones disponibles, pero lo más importante para recordar es que la mayoría de estas herramientas no funcionarán sin credenciales de usuario de dominio válidos en cualquier nivel de permiso. Entonces, como mínimo, tendremos que haber adquirido la contraseña de ClearText de un usuario, el hash de contraseña NTLM o el acceso al sistema en un host unido por dominio.

Para seguir, generar el objetivo en la parte inferior de esta sección y SSH al host de ataque de Linux como el`htb-student`usuario. Para la enumeración de InLaneFreight. Dominio Local utilizando las herramientas instaladas en el host de Linux Attack01, usaremos las siguientes credenciales: User =`forend`y contraseña =`Klmcargo2`. Una vez que se establece nuestro acceso, es hora de ir a trabajar. Comenzaremos con`CrackMapExec`.

---

## Crackmapexec

[Crackmapexec](https://github.com/byt3bl33d3r/CrackMapExec)(CME) es un poderoso conjunto de herramientas para ayudar a evaluar los entornos AD. Utiliza paquetes de los kits de herramientas de PowerSpLoit para realizar sus funciones. Para explicaciones detalladas sobre el uso de la herramienta y los módulos que acompañan, consulte el[wiki](https://github.com/byt3bl33d3r/CrackMapExec/wiki). No tengas miedo de usar el`-h`Indicando para revisar las opciones y la sintaxis disponibles.

#### Menú de ayuda de CME

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ crackmapexec -h

usage: crackmapexec [-h] [-t THREADS] [--timeout TIMEOUT] [--jitter INTERVAL] [--darrell]
                    [--verbose]
                    {mssql,smb,ssh,winrm} ...

      ______ .______           ___        ______  __  ___ .___  ___.      ___      .______    _______ ___   ___  _______   ______
     /      ||   _  \         /   \      /      ||  |/  / |   \/   |     /   \     |   _  \  |   ____|\  \ /  / |   ____| /      |
    |  ,----'|  |_)  |       /  ^  \    |  ,----'|  '  /  |  \  /  |    /  ^  \    |  |_)  | |  |__    \  V  /  |  |__   |  ,----'
    |  |     |      /       /  /_\  \   |  |     |    <   |  |\/|  |   /  /_\  \   |   ___/  |   __|    >   <   |   __|  |  |
    |  `----.|  |\  \----. /  _____  \  |  `----.|  .  \  |  |  |  |  /  _____  \  |  |      |  |____  /  .  \  |  |____ |  `----.
     \______|| _| `._____|/__/     \__\  \______||__|\__\ |__|  |__| /__/     \__\ | _|      |_______|/__/ \__\ |_______| \______|

                                         A swiss army knife for pentesting networks
                                    Forged by @byt3bl33d3r using the powah of dank memes

                                                      Version: 5.0.2dev
                                                     Codename: P3l1as
optional arguments:
  -h, --help            show this help message and exit
  -t THREADS            set how many concurrent threads to use (default: 100)
  --timeout TIMEOUT     max timeout in seconds of each thread (default: None)
  --jitter INTERVAL     sets a random delay between each connection (default: None)
  --darrell             give Darrell a hand
  --verbose             enable verbose output

protocols:
  available protocols

  {mssql,smb,ssh,winrm}
    mssql               own stuff using MSSQL
    smb                 own stuff using SMB
    ssh                 own stuff using SSH
    winrm               own stuff using WINRM

Ya feelin' a bit buggy all of a sudden?
```

Podemos ver que podemos usar las credenciales de la herramienta con MSSQL, SMB, SSH y WinRM. Veamos nuestras opciones para CME con el protocolo SMB:

#### Opciones de CME (SMB)

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ crackmapexec smb -h

usage: crackmapexec smb [-h] [-id CRED_ID [CRED_ID ...]] [-u USERNAME [USERNAME ...]] [-p PASSWORD [PASSWORD ...]] [-k]
                        [--aesKey AESKEY [AESKEY ...]] [--kdcHost KDCHOST]
                        [--gfail-limit LIMIT | --ufail-limit LIMIT | --fail-limit LIMIT] [-M MODULE]
                        [-o MODULE_OPTION [MODULE_OPTION ...]] [-L] [--options] [--server {https,http}] [--server-host HOST]
                        [--server-port PORT] [-H HASH [HASH ...]] [--no-bruteforce] [-d DOMAIN | --local-auth] [--port {139,445}]
                        [--share SHARE] [--smb-server-port SMB_SERVER_PORT] [--gen-relay-list OUTPUT_FILE] [--continue-on-success]
                        [--sam | --lsa | --ntds [{drsuapi,vss}]] [--shares] [--sessions] [--disks] [--loggedon-users] [--users [USER]]
                        [--groups [GROUP]] [--local-groups [GROUP]] [--pass-pol] [--rid-brute [MAX_RID]] [--wmi QUERY]
                        [--wmi-namespace NAMESPACE] [--spider SHARE] [--spider-folder FOLDER] [--content] [--exclude-dirs DIR_LIST]
                        [--pattern PATTERN [PATTERN ...] | --regex REGEX [REGEX ...]] [--depth DEPTH] [--only-files]
                        [--put-file FILE FILE] [--get-file FILE FILE] [--exec-method {atexec,smbexec,wmiexec,mmcexec}] [--force-ps32]
                        [--no-output] [-x COMMAND | -X PS_COMMAND] [--obfs] [--amsi-bypass FILE] [--clear-obfscripts]
                        [target ...]

positional arguments:
  target                the target IP(s), range(s), CIDR(s), hostname(s), FQDN(s), file(s) containing a list of targets, NMap XML or
                        .Nessus file(s)

optional arguments:
  -h, --help            show this help message and exit
  -id CRED_ID [CRED_ID ...]
                        database credential ID(s) to use for authentication
  -u USERNAME [USERNAME ...]
                        username(s) or file(s) containing usernames
  -p PASSWORD [PASSWORD ...]
                        password(s) or file(s) containing passwords
  -k, --kerberos        Use Kerberos authentication from ccache file (KRB5CCNAME)
  
<SNIP>  
```

CME ofrece un menú de ayuda para cada protocolo (es decir,`crackmapexec winrm -h`, etc.). Asegúrese de revisar todo el menú de ayuda y todas las opciones posibles. Por ahora, las banderas que nos interesan son:

- -U nombre de usuario`The user whose credentials we will use to authenticate`
- -P contraseña`User's password`
- Target (IP o FQDN)`Target host to enumerate`(En nuestro caso, el controlador de dominio)
- -usuarios`Specifies to enumerate Domain Users`
- -Grupos`Specifies to enumerate domain groups`
- --soggedon-users`Attempts to enumerate what users are logged on to a target, if any`

Comenzaremos usando el protocolo SMB para enumerar a los usuarios y grupos. Se dirigiremos al controlador de dominio (cuya dirección descubrimos anteriormente) porque contiene todos los datos en la base de datos de dominio que nos interesa. Asegúrese de prefacionar todos los comandos con`sudo`.

#### CME - Enumeración del usuario del dominio

Comenzamos señalando CME en el controlador de dominio y utilizando las credenciales para el`forend`Usuario para recuperar una lista de todos los usuarios de dominio. Observe cuándo nos proporciona la información del usuario, incluye puntos de datos como el[badpwdcount](https://docs.microsoft.com/en-us/windows/win32/adschema/a-badpwdcount)atributo. Esto es útil al realizar acciones como la pulverización de contraseña específica. Podríamos crear una lista de usuarios de destino que filtrara a cualquier usuario con su`badPwdCount`Atribuir por encima de 0 para tener más cuidado de no bloquear ninguna cuenta.

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --users

SMB         172.16.5.5      445    ACADEMY-EA-DC01  [*] Windows 10.0 Build 17763 x64 (name:ACADEMY-EA-DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False)
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] INLANEFREIGHT.LOCAL\forend:Klmcargo2 
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] Enumerated domain user(s)
SMB         172.16.5.5      445    ACADEMY-EA-DC01  INLANEFREIGHT.LOCAL\administrator                  badpwdcount: 0 baddpwdtime: 2022-03-29 12:29:14.476567
SMB         172.16.5.5      445    ACADEMY-EA-DC01  INLANEFREIGHT.LOCAL\guest                          badpwdcount: 0 baddpwdtime: 1600-12-31 19:03:58
SMB         172.16.5.5      445    ACADEMY-EA-DC01  INLANEFREIGHT.LOCAL\lab_adm                        badpwdcount: 0 baddpwdtime: 2022-04-09 23:04:58.611828
SMB         172.16.5.5      445    ACADEMY-EA-DC01  INLANEFREIGHT.LOCAL\krbtgt                         badpwdcount: 0 baddpwdtime: 1600-12-31 19:03:58
SMB         172.16.5.5      445    ACADEMY-EA-DC01  INLANEFREIGHT.LOCAL\htb-student                    badpwdcount: 0 baddpwdtime: 2022-03-30 16:27:41.960920
SMB         172.16.5.5      445    ACADEMY-EA-DC01  INLANEFREIGHT.LOCAL\avazquez                       badpwdcount: 3 baddpwdtime: 2022-02-24 18:10:01.903395

<SNIP>
```

También podemos obtener una lista completa de grupos de dominio. Deberíamos guardar toda nuestra salida en los archivos para acceder fácilmente a ella nuevamente más tarde para informar o usar con otras herramientas.

#### CME - Enumeración del grupo de dominio

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --groups
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [*] Windows 10.0 Build 17763 x64 (name:ACADEMY-EA-DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False)
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] INLANEFREIGHT.LOCAL\forend:Klmcargo2 
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] Enumerated domain group(s)
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Administrators                           membercount: 3
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Users                                    membercount: 4
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Guests                                   membercount: 2
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Print Operators                          membercount: 0
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Backup Operators                         membercount: 1
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Replicator                               membercount: 0

<SNIP>

SMB         172.16.5.5      445    ACADEMY-EA-DC01  Domain Admins                            membercount: 19
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Domain Users                             membercount: 0

<SNIP>

SMB         172.16.5.5      445    ACADEMY-EA-DC01  Contractors                              membercount: 138
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Accounting                               membercount: 15
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Engineering                              membercount: 19
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Executives                               membercount: 10
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Human Resources                          membercount: 36

<SNIP>
```

El fragmento anterior enumera los grupos dentro del dominio y el número de usuarios en cada uno. La salida también muestra los grupos incorporados en el controlador de dominio, como`Backup Operators`. Podemos comenzar a anotar grupos de interés. Tome nota de grupos clave como`Administrators`, `Domain Admins`, `Executives`, cualquier grupo que pueda contener administradores de TI privilegiados, etc. Estos grupos probablemente contengan usuarios con privilegios elevados que vale la pena apuntar durante nuestra evaluación.

#### CME: registrado en los usuarios

También podemos usar CME para apuntar a otros hosts. Veamos qué parece ser un servidor de archivos para ver en qué se registran los usuarios actualmente.

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ sudo crackmapexec smb 172.16.5.130 -u forend -p Klmcargo2 --loggedon-users

SMB         172.16.5.130    445    ACADEMY-EA-FILE  [*] Windows 10.0 Build 17763 x64 (name:ACADEMY-EA-FILE) (domain:INLANEFREIGHT.LOCAL) (signing:False) (SMBv1:False)
SMB         172.16.5.130    445    ACADEMY-EA-FILE  [+] INLANEFREIGHT.LOCAL\forend:Klmcargo2 (Pwn3d!)
SMB         172.16.5.130    445    ACADEMY-EA-FILE  [+] Enumerated loggedon users
SMB         172.16.5.130    445    ACADEMY-EA-FILE  INLANEFREIGHT\clusteragent              logon_server: ACADEMY-EA-DC01
SMB         172.16.5.130    445    ACADEMY-EA-FILE  INLANEFREIGHT\lab_adm                   logon_server: ACADEMY-EA-DC01
SMB         172.16.5.130    445    ACADEMY-EA-FILE  INLANEFREIGHT\svc_qualys                logon_server: ACADEMY-EA-DC01
SMB         172.16.5.130    445    ACADEMY-EA-FILE  INLANEFREIGHT\wley                      logon_server: ACADEMY-EA-DC01

<SNIP>
```

Vemos que muchos usuarios están registrados en este servidor, lo cual es muy interesante. También podemos ver que nuestro usuario`forend`es un administrador local porque`(Pwn3d!)`aparece después de que la herramienta se autentica con éxito al host de destino. Un host como este puede ser utilizado como un host de salto o similar por usuarios administrativos. Podemos ver que el usuario`svc_qualys`está conectado, a quien identificamos anteriormente como administrador de dominio. Podría ser una victoria fácil si podemos robar las credenciales de este usuario de la memoria o hacerse pasar por ellas.

Como veremos más adelante,`BloodHound`(y otras herramientas como`PowerView`) se pueden usar para buscar sesiones de usuario. Bloodhound es particularmente poderoso, ya que podemos usarlo para ver sesiones de usuario de dominio de manera gráfica y rápida de muchas maneras. De todos modos, herramientas como CME son excelentes para una enumeración más específica y la caza de usuarios.

#### CME Share Buscar

Podemos usar el`--shares`Indicador para enumerar las acciones disponibles en el host remoto y el nivel de acceso que nuestra cuenta de usuario tiene a cada acción (lectura o acceso de escritura). Ejecutemos esto contra el controlador de dominio LaneFreight.

#### Compartir enumeración - controlador de dominio

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --shares

SMB         172.16.5.5      445    ACADEMY-EA-DC01  [*] Windows 10.0 Build 17763 x64 (name:ACADEMY-EA-DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False)
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] INLANEFREIGHT.LOCAL\forend:Klmcargo2 
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] Enumerated shares
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Share           Permissions     Remark
SMB         172.16.5.5      445    ACADEMY-EA-DC01  -----           -----------     ------
SMB         172.16.5.5      445    ACADEMY-EA-DC01  ADMIN$                          Remote Admin
SMB         172.16.5.5      445    ACADEMY-EA-DC01  C$                              Default share
SMB         172.16.5.5      445    ACADEMY-EA-DC01  Department Shares READ            
SMB         172.16.5.5      445    ACADEMY-EA-DC01  IPC$            READ            Remote IPC
SMB         172.16.5.5      445    ACADEMY-EA-DC01  NETLOGON        READ            Logon server share 
SMB         172.16.5.5      445    ACADEMY-EA-DC01  SYSVOL          READ            Logon server share 
SMB         172.16.5.5      445    ACADEMY-EA-DC01  User Shares     READ            
SMB         172.16.5.5      445    ACADEMY-EA-DC01  ZZZ_archive     READ 
```

Vemos varias acciones disponibles para nosotros con`READ`acceso. El`Department Shares`, `User Shares`, y`ZZZ_archive`Vale la pena profundizar en las acciones, ya que pueden contener datos confidenciales como contraseñas o PII. A continuación, podemos profundizar en las acciones y araña cada directorio que busca archivos. El módulo`spider_plus`Cavará a través de cada compartir legible en el host y enumerará todos los archivos legibles. Vamos a intentarlo.

#### Spider_plus

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share 'Department Shares'

SMB         172.16.5.5      445    ACADEMY-EA-DC01  [*] Windows 10.0 Build 17763 x64 (name:ACADEMY-EA-DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False)
SMB         172.16.5.5      445    ACADEMY-EA-DC01  [+] INLANEFREIGHT.LOCAL\forend:Klmcargo2 
SPIDER_P... 172.16.5.5      445    ACADEMY-EA-DC01  [*] Started spidering plus with option:
SPIDER_P... 172.16.5.5      445    ACADEMY-EA-DC01  [*]        DIR: ['print$']
SPIDER_P... 172.16.5.5      445    ACADEMY-EA-DC01  [*]        EXT: ['ico', 'lnk']
SPIDER_P... 172.16.5.5      445    ACADEMY-EA-DC01  [*]       SIZE: 51200
SPIDER_P... 172.16.5.5      445    ACADEMY-EA-DC01  [*]     OUTPUT: /tmp/cme_spider_plus
```

En el comando anterior, corrimos la araña contra el`Department Shares`. Cuando se completa, CME escribe los resultados en un archivo JSON ubicado en`/tmp/cme_spider_plus/<ip of host>`. A continuación podemos ver una parte de la salida JSON. Podríamos buscar archivos interesantes como`web.config`archivos o scripts que pueden contener contraseñas. Si quisiéramos cavar más, podríamos extraer esos archivos para ver qué reside todo dentro, tal vez encontrando algunas credenciales codificadas u otra información confidencial.

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ head -n 10 /tmp/cme_spider_plus/172.16.5.5.json 

{
    "Department Shares": {
        "Accounting/Private/AddSelect.bat": {
            "atime_epoch": "2022-03-31 14:44:42",
            "ctime_epoch": "2022-03-31 14:44:39",
            "mtime_epoch": "2022-03-31 15:14:46",
            "size": "278 Bytes"
        },
        "Accounting/Private/ApproveConnect.wmf": {
            "atime_epoch": "2022-03-31 14:45:14",
     
<SNIP>
```

CME es poderoso, y esto es solo una pequeña mirada a sus capacidades; Vale la pena experimentar con él más contra los objetivos de laboratorio. Utilizaremos CME de varias maneras a medida que avanzamos a través del resto de este módulo. Sigamos adelante y echemos un vistazo a[Smbmap](https://github.com/ShawnDEvans/smbmap)ahora.

---

## Smbmap

SMBMAP es excelente para enumerar las acciones de SMB de un host de ataque de Linux. Se puede utilizar para reunir una lista de acciones, permisos y contenidos de compartir si es accesible. Una vez que se obtiene el acceso, se puede usar para descargar y cargar archivos y ejecutar comandos remotos.

Al igual que CME, podemos usar SMBMAP y un conjunto de credenciales de usuario de dominio para verificar las acciones accesibles en sistemas remotos. Como con otras herramientas, podemos escribir el comando`smbmap` `-h`Para ver el menú de uso de la herramienta. Además de enumerar las acciones, podemos usar SMBMAP para enumerar recursivamente directorios, enumerar el contenido de un directorio, contenido del archivo de búsqueda y más. Esto puede ser especialmente útil al saquear las acciones para obtener información útil.

#### SMBMAP para verificar el acceso

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5

[+] IP: 172.16.5.5:445	Name: inlanefreight.local                               
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	Department Shares                                 	READ ONLY	
	IPC$                                              	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share 
	SYSVOL                                            	READ ONLY	Logon server share 
	User Shares                                       	READ ONLY	
	ZZZ_archive                                       	READ ONLY
```

Lo anterior nos dirá a qué puede acceder nuestro usuario y sus niveles de permiso. Al igual que nuestros resultados de CME, vemos que el usuario`forend`no tiene acceso al DC a través del`ADMIN$`o`C$`acciones (esto se espera para una cuenta de usuario estándar), pero tiene acceso de lectura sobre`IPC$`, `NETLOGON`, y`SYSVOL`cuál es el valor predeterminado en cualquier dominio. Las otras acciones no estándar, como`Department Shares`Y el usuario y las acciones de archivo son más interesantes. Hagamos una lista recursiva de los directorios en el`Department Shares`compartir. Podemos ver, como se esperaba, subdirectorios para cada departamento de la empresa.

#### Lista recursiva de todos los directorios

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R 'Department Shares' --dir-only

[+] IP: 172.16.5.5:445	Name: inlanefreight.local                               
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	Department Shares                                 	READ ONLY	
	.\Department Shares\*
	dr--r--r--                0 Thu Mar 31 15:34:29 2022	.
	dr--r--r--                0 Thu Mar 31 15:34:29 2022	..
	dr--r--r--                0 Thu Mar 31 15:14:48 2022	Accounting
	dr--r--r--                0 Thu Mar 31 15:14:39 2022	Executives
	dr--r--r--                0 Thu Mar 31 15:14:57 2022	Finance
	dr--r--r--                0 Thu Mar 31 15:15:04 2022	HR
	dr--r--r--                0 Thu Mar 31 15:15:21 2022	IT
	dr--r--r--                0 Thu Mar 31 15:15:29 2022	Legal
	dr--r--r--                0 Thu Mar 31 15:15:37 2022	Marketing
	dr--r--r--                0 Thu Mar 31 15:15:47 2022	Operations
	dr--r--r--                0 Thu Mar 31 15:15:58 2022	R&D
	dr--r--r--                0 Thu Mar 31 15:16:10 2022	Temp
	dr--r--r--                0 Thu Mar 31 15:16:18 2022	Warehouse

    <SNIP>
```

A medida que el listado recursivo se sumerja más profundamente, le mostrará la salida de todos los subdirectorios dentro de los directorios de nivel superior. El uso de`--dir-only`proporcionó solo la salida de todos los directorios y no enumeró todos los archivos. Pruebe esto contra otras acciones en el controlador de dominio y vea lo que puede encontrar.

Ahora que hemos cubierto las acciones, veamos`RPCClient`.

---

## rpcclient

[rpcclient](https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html)es una herramienta útil creada para usar con el protocolo Samba y para proporcionar funcionalidad adicional a través de MS-RPC. Puede enumerar, agregar, cambiar e incluso eliminar objetos de AD. Es altamente versátil; Solo tenemos que encontrar el comando correcto para emitir lo que queremos lograr. La página del hombre para RPCClient es muy útil para esto; Solo escribe`man rpcclient`En el shell de su host de ataque y revise las opciones disponibles. Cubramos algunas funciones de RPCclient que pueden ser útiles durante una prueba de penetración.

Debido a las sesiones nulas de SMB (cubiertas en profundidad en las secciones de pulverización de contraseña) en algunos de nuestros hosts, podemos realizar una enumeración autenticada o no autenticada utilizando RPCClient en el dominio LaneFreight.local. Un ejemplo de uso de RPCClient desde un punto de vista no autenticado (si esta configuración existe en nuestro dominio de destino) sería:

Código:intento

```bash
rpcclient -U "" -N 172.16.5.5
```

Lo anterior nos proporcionará una conexión vinculada, y deberíamos recibir un nuevo aviso para comenzar a desatar el poder de RPCClient.

#### Sesión nula de SMB con rpcclient

![image](https://academy.hackthebox.com/storage/modules/143/rpcclient.png)

Desde aquí, podemos comenzar a enumerar cualquier cantidad de cosas diferentes. Comencemos con los usuarios de dominio.

#### enumeración de rpcclient

Mientras mira a los usuarios en RPCClient, puede notar un campo llamado`rid:`al lado de cada usuario. A[Identificador relativo (Rid)](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)es un identificador único (representado en formato hexadecimal) utilizado por Windows para rastrear e identificar objetos. Para explicar cómo se ajusta esto, veamos los ejemplos a continuación:

- El[Sid](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers)para el dominio de inlanefreight.local es:`S-1-5-21-3842939050-3880317879-2865463114`.
- Cuando se crea un objeto dentro de un dominio, el número anterior (SID) se combinará con un RID para hacer un valor único utilizado para representar el objeto.
- Entonces el usuario del dominio`htb-student`Con un Rid: [0x457] Hex 0x457 lo haría = decimal`1111`, tendrá un usuario completo SID de:`S-1-5-21-3842939050-3880317879-2865463114-1111`.
- Esto es exclusivo del`htb-student`Objeto en el dominio LaneFreight.

Sin embargo, hay cuentas que notará que tienen el mismo deshielo independientemente del anfitrión en el que se encuentre. Cuentas como el administrador incorporado para un dominio tendrán un Rid [Administrador] RID: [0x1f4], que, cuando se convierte en un valor decimal, es igual a`500`. La cuenta de administrador incorporada siempre tendrá el valor de eliminación`Hex 0x1f4`, o 500. Este siempre será el caso. Dado que este valor es exclusivo de un objeto, podemos usarlo para enumerar más información al respecto del dominio. Vamos a intentarlo nuevamente con RPCClient. Cavaremos un poco apuntando al`htb-student`usuario.

#### Enumeración del usuario de RPCClient por RID

  Enumeración acreditada: de Linux

```shell-session
rpcclient $> queryuser 0x457

        User Name   :   htb-student
        Full Name   :   Htb Student
        Home Drive  :
        Dir Drive   :
        Profile Path:
        Logon Script:
        Description :
        Workstations:
        Comment     :
        Remote Dial :
        Logon Time               :      Wed, 02 Mar 2022 15:34:32 EST
        Logoff Time              :      Wed, 31 Dec 1969 19:00:00 EST
        Kickoff Time             :      Wed, 13 Sep 30828 22:48:05 EDT
        Password last set Time   :      Wed, 27 Oct 2021 12:26:52 EDT
        Password can change Time :      Thu, 28 Oct 2021 12:26:52 EDT
        Password must change Time:      Wed, 13 Sep 30828 22:48:05 EDT
        unknown_2[0..31]...
        user_rid :      0x457
        group_rid:      0x201
        acb_info :      0x00000010
        fields_present: 0x00ffffff
        logon_divs:     168
        bad_password_count:     0x00000000
        logon_count:    0x0000001d
        padding1[0..7]...
        logon_hrs[0..21]...
```

Cuando buscamos información utilizando el`queryuser`comandar contra el Rid`0x457`, RPC devolvió la información del usuario para`htb-student`como se esperaba. Esto no fue difícil ya que ya conocíamos el Rid por`htb-student`. Si quisiéramos enumerar a todos los usuarios para reunir las libras por más de uno, usaríamos el`enumdomusers`dominio.

#### Enumomonería

  Enumeración acreditada: de Linux

```shell-session
rpcclient $> enumdomusers

user:[administrator] rid:[0x1f4]
user:[guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[lab_adm] rid:[0x3e9]
user:[htb-student] rid:[0x457]
user:[avazquez] rid:[0x458]
user:[pfalcon] rid:[0x459]
user:[fanthony] rid:[0x45a]
user:[wdillard] rid:[0x45b]
user:[lbradford] rid:[0x45c]
user:[sgage] rid:[0x45d]
user:[asanchez] rid:[0x45e]
user:[dbranch] rid:[0x45f]
user:[ccruz] rid:[0x460]
user:[njohnson] rid:[0x461]
user:[mholliday] rid:[0x462]

<SNIP>  
```

Usarlo de esta manera imprimirá a todos los usuarios de dominio por nombre y RID. Nuestra enumeración puede entrar en gran detalle utilizando RPCclient. Incluso podríamos comenzar a realizar acciones como editar usuarios y grupos o agregar los nuestros al dominio, pero esto está fuera de alcance para este módulo. Por ahora, solo queremos realizar una enumeración de dominio para validar nuestros hallazgos. Tómese un tiempo para jugar con las otras funciones de RPCclient y vea los resultados que producen. Para obtener más información sobre temas como SIDS, Rids y otros componentes centrales de AD, valdría la pena consultar el[Introducción a Active Directory](https://academy.hackthebox.com/course/preview/introduction-to-active-directory)módulo. Ahora, es hora de sumergirse en todo su gloria.

---

## Kit de herramientas de impacket

Impacket es un kit de herramientas versátil que nos proporciona muchas formas diferentes de enumerar, interactuar y explotar los protocolos de Windows y encontrar la información que necesitamos usando Python. La herramienta se mantiene activamente y tiene muchos contribuyentes, especialmente cuando surgen nuevas técnicas de ataque. Podríamos realizar muchas otras acciones con Impacket, pero solo destacaremos algunas en esta sección;[wmiexec.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py)y[psexec.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py). Anteriormente en la sección de envenenamiento, tomamos un hash para el usuario`wley`con`Responder`y lo rompió para obtener la contraseña`transporter@4`. Veremos en la siguiente sección que este usuario es un administrador local en el`ACADEMY-EA-FILE`anfitrión. Utilizaremos las credenciales para las próximas acciones.

#### Psexec.py

Una de las herramientas más útiles en la suite de Impacket es`psexec.py`. Psexec.py es un clon del ejecutable de Sysinternals Psexec, pero funciona de manera ligeramente diferente del original. La herramienta crea un servicio remoto cargando un ejecutable de nombre al azar al`ADMIN$`Compartir en el host de destino. Luego registra el servicio a través de`RPC`y el`Windows Service Control Manager`. Una vez establecida, la comunicación ocurre sobre una tubería con nombre, proporcionando una carcasa remota interactiva como`SYSTEM`en el anfitrión de la víctima.

#### Usando psexec.py

Para conectarse a un host con psexec.py, necesitamos credenciales para un usuario con privilegios de administrador local.

Código:intento

```bash
psexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.125  
```

![image](https://academy.hackthebox.com/storage/modules/143/psexec-action.png)

Una vez que ejecutamos el módulo psexec, nos deja caer en el`system32`directorio en el host de destino. Corrimos el`whoami`comandar para verificar, y confirmó que aterrizamos en el anfitrión como`SYSTEM`. Desde aquí, podemos realizar la mayor parte de cualquier tarea en este host; Cualquier cosa, desde una enumeración adicional hasta la persistencia y el movimiento lateral. Vamos a probar otro módulo de impacket:`wmiexec.py`.

#### wmiexec.py

Wmiexec.py utiliza un shell semi-interactivo donde los comandos se ejecutan a través de[Instrumentación de administración de Windows](https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page). No suelta ningún archivo o ejecutable en el host de destino y genera menos registros que otros módulos. Después de conectarse, se ejecuta como el usuario administrador local con el que nos conectamos (esto puede ser menos obvio para alguien que busca una intrusión que ver el sistema ejecutar muchos comandos). Este es un enfoque más sigiloso para la ejecución en hosts que otras herramientas, pero probablemente sería atrapado por la mayoría de los sistemas antivirus y EDR modernos. Usaremos la misma cuenta que con psexec.py para acceder al host.

#### Usando wmiexec.py

Código:intento

```bash
wmiexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.5  
```

![text](https://academy.hackthebox.com/storage/modules/143/wmiexec-action.png)

Tenga en cuenta que este entorno de shell no es completamente interactivo, por lo que cada comando emitido ejecutará un nuevo cmd.exe de WMI y ejecutará su comando. La desventaja de esto es que si un defensor vigilante verifica los registros de eventos y mira el ID de evento[4688: se ha creado un nuevo proceso](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4688), verán un nuevo proceso creado para generar cmd.exe y emitir un comando. Esto no siempre es una actividad maliciosa ya que muchas organizaciones utilizan WMI para administrar computadoras, pero puede ser un aviso en una investigación. En la imagen de arriba, también es evidente que el proceso se está ejecutando en el contexto del usuario`wley`en el host, no como sistema. Impacket es una herramienta inmensamente valiosa que tiene muchos casos de uso. Veremos muchas otras herramientas en el conjunto de herramientas de Impacket a lo largo del resto de este módulo. Como Pentester que trabaja con hosts de Windows, esta herramienta siempre debe estar en nuestro arsenal. Pasemos a la siguiente herramienta,`Windapsearch`.

---

## Windapsearch

[Windapsearch](https://github.com/ropnop/windapsearch)es otro práctico script de Python que podemos usar para enumerar a los usuarios, grupos y computadoras desde un dominio de Windows utilizando consultas LDAP. Está presente en nuestro host de ataque/OPT/WindapSearch/Directory.

#### Ayuda de Windapsearch

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ windapsearch.py -h

usage: windapsearch.py [-h] [-d DOMAIN] [--dc-ip DC_IP] [-u USER]
                       [-p PASSWORD] [--functionality] [-G] [-U] [-C]
                       [-m GROUP_NAME] [--da] [--admin-objects] [--user-spns]
                       [--unconstrained-users] [--unconstrained-computers]
                       [--gpos] [-s SEARCH_TERM] [-l DN]
                       [--custom CUSTOM_FILTER] [-r] [--attrs ATTRS] [--full]
                       [-o output_dir]

Script to perform Windows domain enumeration through LDAP queries to a Domain
Controller

optional arguments:
  -h, --help            show this help message and exit

Domain Options:
  -d DOMAIN, --domain DOMAIN
                        The FQDN of the domain (e.g. 'lab.example.com'). Only
                        needed if DC-IP not provided
  --dc-ip DC_IP         The IP address of a domain controller

Bind Options:
  Specify bind account. If not specified, anonymous bind will be attempted

  -u USER, --user USER  The full username with domain to bind with (e.g.
                        'ropnop@lab.example.com' or 'LAB\ropnop'
  -p PASSWORD, --password PASSWORD
                        Password to use. If not specified, will be prompted
                        for

Enumeration Options:
  Data to enumerate from LDAP

  --functionality       Enumerate Domain Functionality level. Possible through
                        anonymous bind
  -G, --groups          Enumerate all AD Groups
  -U, --users           Enumerate all AD Users
  -PU, --privileged-users
                        Enumerate All privileged AD Users. Performs recursive
                        lookups for nested members.
  -C, --computers       Enumerate all AD Computers

  <SNIP>
```

Tenemos varias opciones con WindapSearch para realizar una enumeración estándar (dumping usuarios, computadoras y grupos) y una enumeración más detallada. El`--da`(Opción del grupo de administradores de dominio enumerados)`-PU`(Encuentra las opciones de usuarios privilegiados). El`-PU`La opción es interesante porque realizará una búsqueda recursiva de usuarios con membresía de grupo anidada.

#### Windapsearch - Administradores de dominio

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 --da

[+] Using Domain Controller at: 172.16.5.5
[+] Getting defaultNamingContext from Root DSE
[+]	Found: DC=INLANEFREIGHT,DC=LOCAL
[+] Attempting bind
[+]	...success! Binded as: 
[+]	 u:INLANEFREIGHT\forend
[+] Attempting to enumerate all Domain Admins
[+] Using DN: CN=Domain Admins,CN=Users.CN=Domain Admins,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
[+]	Found 28 Domain Admins:

cn: Administrator
userPrincipalName: administrator@inlanefreight.local

cn: lab_adm

cn: Matthew Morgan
userPrincipalName: mmorgan@inlanefreight.local

<SNIP>
```

De los resultados en el shell anterior, podemos ver que enumeró a 28 usuarios del grupo de administradores de dominio. Tome nota de algunos usuarios que ya hemos visto antes e incluso pueden tener una contraseña hash o ClearText como`wley`, `svc_qualys`, y`lab_adm`.

Para identificar más usuarios potenciales, podemos ejecutar la herramienta con el`-PU`Marcar y verificar a los usuarios con privilegios elevados que puedan haber pasado desapercibidos. Este es un excelente cheque para informar, ya que probablemente informará al cliente a los usuarios con un exceso de privilegios de la membresía del grupo anidada.

#### Windapsearch: usuarios privilegiados

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 -PU

[+] Using Domain Controller at: 172.16.5.5
[+] Getting defaultNamingContext from Root DSE
[+]     Found: DC=INLANEFREIGHT,DC=LOCAL
[+] Attempting bind
[+]     ...success! Binded as:
[+]      u:INLANEFREIGHT\forend
[+] Attempting to enumerate all AD privileged users
[+] Using DN: CN=Domain Admins,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
[+]     Found 28 nested users for group Domain Admins:

cn: Administrator
userPrincipalName: administrator@inlanefreight.local

cn: lab_adm

cn: Angela Dunn
userPrincipalName: adunn@inlanefreight.local

cn: Matthew Morgan
userPrincipalName: mmorgan@inlanefreight.local

cn: Dorothy Click
userPrincipalName: dclick@inlanefreight.local

<SNIP>

[+] Using DN: CN=Enterprise Admins,CN=Users,DC=INLANEFREIGHT,DC=LOCAL
[+]     Found 3 nested users for group Enterprise Admins:

cn: Administrator
userPrincipalName: administrator@inlanefreight.local

cn: lab_adm

cn: Sharepoint Admin
userPrincipalName: sp-admin@INLANEFREIGHT.LOCAL

<SNIP>
```

Notará que realizó mutaciones contra nombres de grupos elevados comunes en diferentes idiomas. Esta salida ofrece un ejemplo de los peligros de la membresía del grupo anidado, y esto se hará más evidente cuando trabajemos con los gráficos de Bloodhound para visualizar esto.

---

## Bloodhound.py

Una vez que tenemos credenciales de dominio, podemos ejecutar el[Bloodhound.py](https://github.com/fox-it/BloodHound.py)Bloodhound Ingestor de nuestro host de ataque de Linux. Bloodhound es una de las herramientas más impactantes que se hayan lanzado para auditar la seguridad de Active Directory, y es muy beneficioso para nosotros como probadores de penetración. Podemos tomar grandes cantidades de datos que llevarían mucho tiempo para examinar y crear representaciones gráficas o "rutas de ataque" de dónde puede llevar el acceso con un usuario en particular. A menudo encontraremos defectos matizados en un entorno publicitario que se habría perdido sin la capacidad de ejecutar consultas con la herramienta GUI de Bloodhound y visualizar problemas. La herramienta usa[teoría de grafos](https://en.wikipedia.org/wiki/Graph_theory)Representar visualmente las relaciones y descubrir caminos de ataque que hubieran sido difíciles, o incluso imposibles de detectar con otras herramientas. La herramienta consta de dos partes: el[Coleccionista de Sharphound](https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors)Escrito en C# para su uso en los sistemas de Windows, o para esta sección, el coleccionista Bloodhound.py (también se conoce como un`ingestor`) y el[Sabueso](https://github.com/BloodHoundAD/BloodHound/releases)Herramienta GUI que nos permite cargar datos recopilados en forma de archivos JSON. Una vez cargado, podemos ejecutar varias consultas previas a la construcción o escribir consultas personalizadas usando[Lenguaje cepher](https://blog.cptjesus.com/posts/introtocypher). La herramienta recopila datos de AD, como usuarios, grupos, computadoras, membresía de grupo, GPOS, ACL, fideicomisos de dominio, acceso de administrador local, sesiones de usuario, propiedades de computadora y usuario, acceso RDP, acceso WinRM, etc.

Inicialmente, solo se lanzó con un coleccionista de PowerShell, por lo que tuvo que ejecutarse desde un host de Windows. Finalmente, un puerto de Python (que requiere impacket,`ldap3`, y`dnspython`) fue lanzado por un miembro de la comunidad. Esto ayudó enormemente durante las pruebas de penetración cuando tenemos credenciales de dominio válidas, pero no tenemos derechos para acceder a un host de Windows unido por dominio o no tienen un host de ataque de Windows para ejecutar el coleccionista de Sharphound. Esto también nos ayuda a no tener que ejecutar el coleccionista desde un host de dominio, que podría bloquearse o activar alertas (aunque incluso ejecutarlo desde nuestro host de ataque probablemente activará las alarmas en entornos bien protegidos).

Correr`bloodhound-python -h`De nuestro host de Attack de Linux nos mostrará las opciones disponibles.

#### Opciones de BloodHound.py

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ bloodhound-python -h

usage: bloodhound-python [-h] [-c COLLECTIONMETHOD] [-u USERNAME]
                         [-p PASSWORD] [-k] [--hashes HASHES] [-ns NAMESERVER]
                         [--dns-tcp] [--dns-timeout DNS_TIMEOUT] [-d DOMAIN]
                         [-dc HOST] [-gc HOST] [-w WORKERS] [-v]
                         [--disable-pooling] [--disable-autogc] [--zip]

Python based ingestor for BloodHound
For help or reporting issues, visit https://github.com/Fox-IT/BloodHound.py

optional arguments:
  -h, --help            show this help message and exit
  -c COLLECTIONMETHOD, --collectionmethod COLLECTIONMETHOD
                        Which information to collect. Supported: Group,
                        LocalAdmin, Session, Trusts, Default (all previous),
                        DCOnly (no computer connections), DCOM, RDP,PSRemote,
                        LoggedOn, ObjectProps, ACL, All (all except LoggedOn).
                        You can specify more than one by separating them with
                        a comma. (default: Default)
  -u USERNAME, --username USERNAME
                        Username. Format: username[@domain]; If the domain is
                        unspecified, the current domain is used.
  -p PASSWORD, --password PASSWORD
                        Password

  <SNIP>
```

Como podemos ver, la herramienta acepta varios métodos de recolección con el`-c`o`--collectionmethod`bandera. Podemos recuperar datos específicos, como sesiones de usuario, usuarios y grupos, propiedades de objetos, ACL o seleccionar`all`para recopilar tantos datos como sea posible. Vamos a ejecutarlo de esta manera.

#### Ejecutando Bloodhound.py

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ sudo bloodhound-python -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 -d inlanefreight.local -c all 

INFO: Found AD domain: inlanefreight.local
INFO: Connecting to LDAP server: ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
INFO: Found 1 domains
INFO: Found 2 domains in the forest
INFO: Found 564 computers
INFO: Connecting to LDAP server: ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
INFO: Found 2951 users
INFO: Connecting to GC LDAP server: ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
INFO: Found 183 groups
INFO: Found 2 trusts
INFO: Starting computer enumeration with 10 workers

<SNIP>
```

El comando anteriormente ejecutado BloodHound.py con el usuario`forend`. Especificamos nuestro servidor de nombres como controlador de dominio con el`-ns`bandera y el dominio, inlanefreight.local con el`-d`bandera. El`-c all`Flag le dijo a la herramienta que ejecute todos los cheques. Una vez que finalice el script, veremos los archivos de salida en el directorio de trabajo actual en formato de .

#### Ver los resultados

  Enumeración acreditada: de Linux

```shell-session
xnoxos@htb[/htb]$ ls

20220307163102_computers.json  20220307163102_domains.json  20220307163102_groups.json  20220307163102_users.json  
```

#### Sube el archivo zip en la GUI de Bloodhound

Entonces podríamos escribir`sudo neo4j start`Para comenzar el[neo4J](https://neo4j.com/)Servicio, encendiendo la base de datos en la que cargaremos los datos y también ejecutarán consultas de Cypher.

A continuación, podemos escribir`bloodhound`de nuestro host de ataque de Linux cuando se inicia sesión en uso`freerdp`Para iniciar la aplicación GUI de Bloodhound y cargar los datos. Las credenciales se poblan previamente en el host de ataque de Linux, pero si por alguna razón se muestra un mensaje de credencial, use:

- `user == neo4j` / `pass == HTB_@cademy_stdnt!`.

Una vez que todo lo anterior esté listo, debemos tener la herramienta GUI de Bloodhound cargada con una pizarra en blanco. Ahora necesitamos cargar los datos. Podemos cargar cada archivo JSON uno por uno o crecer primero con un comando como`zip -r ilfreight_bh.zip *.json`y cargar el archivo zip. Hacemos esto haciendo clic en el`Upload Data`botón en el lado derecho de la ventana (flecha verde). Cuando aparezca la ventana del navegador de archivos para seleccionar un archivo, elija el archivo zip (o cada archivo json) (flecha roja) y presione`Open`.

#### Cargar el archivo zip

![image](https://academy.hackthebox.com/storage/modules/143/bh-injest.png)

Ahora que los datos están cargados, podemos usar la pestaña Análisis para ejecutar consultas en la base de datos. Estas consultas pueden ser personalizadas y específicas de lo que decide usar[Consultas de Cypher personalizadas](https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/). Hay muchas hojas de trucos geniales para ayudarnos aquí. Discutiremos más consultas de Cypher Custom en una sección posterior. Como se ve a continuación, podemos usar el incorporado`Path Finding`consultas en el`Analysis tab`en el`Left`lado de la ventana.

#### Buscando relaciones

![image](https://academy.hackthebox.com/storage/modules/143/bh-analysis.png)

La consulta elegida para producir el mapa de arriba fue`Find Shortest Paths To Domain Admins`. Nos dará cualquier ruta lógica que encuentre a través de usuarios/grupos/hosts/ACL/GPO, etc., relaciones que probablemente nos permitirán escalar a los privilegios del administrador del dominio o equivalentes. Esto será extremadamente útil al planificar nuestros próximos pasos para el movimiento lateral a través de la red. Tómese un tiempo para experimentar con las diversas características: mire el`Database Info`pestaña Después de cargar datos, busque un nodo como`Domain Users`y, desplácese por todas las opciones bajo el`Node Info`pestaña, consulte las consultas preconstruidas debajo del`Analysis`Pestaña, muchos que son poderosos y pueden encontrar rápidamente varias formas de adquisición de dominio. Finalmente, experimente con algunas consultas de Cypher personalizadas seleccionando algunas interesantes de la hoja de trucos de Cypher vinculada anteriormente, pegándolas en el`Raw Query`Cuadro en la parte inferior y presionando entrar. También puedes jugar con el`Settings`Menú haciendo clic en el icono de engranaje en el lado derecho de la pantalla y ajustando cómo se muestran los nodos y los bordes, habiliten el modo de depuración de consultas y habilite el modo oscuro. A lo largo del resto de este módulo, usaremos BloodShound de varias maneras, pero para un estudio dedicado sobre la herramienta Bloodhound, consulte el[Bloodal de Directorio Active](https://academy.hackthebox.com/course/preview/active-directory-bloodhound)módulo.

En la siguiente sección, cubriremos la ejecución del coleccionista de Sharphound desde un host de Windows unido al dominio y trabajaremos a través de algunos ejemplos de trabajo con los datos en la GUI de Bloodhound.

---

Experimentamos con varias herramientas nuevas para la enumeración de dominio de un host de Linux. La siguiente sección cubrirá varias herramientas más que podamos usar desde un host de Windows unido al dominio. Como nota rápida, si no ha revisado el[Proyecto Wadcoms](https://wadcoms.github.io/)Sin embargo, definitivamente deberías. Es una hoja de trucos interactiva para muchas de las herramientas que cubriremos (y más) en este módulo. Es muy útil cuando no puede recordar la sintaxis del comando exacto o está probando una herramienta por primera vez. Vale la pena marcadores e incluso[que contribuye](https://wadcoms.github.io/contribute/)¡a!

Ahora, cambiemos de marcha y comencemos a cavar en el dominio LaneFreight.