# Transferencias de archivos

Hay muchas situaciones cuando es necesario transferir archivos a o desde un sistema de destino. Imaginemos el siguiente escenario:

# **Estableciendo el escenario**

Durante una participación, obtenemos la ejecución de código remoto (RCE) en un servidor web IIS a través de una vulnerabilidad de carga de archivos sin restricciones. Inicialmente, subimos un shell web y luego nos enviamos un shell inverso para enumerar el sistema aún más en un intento de aumentar los privilegios. Intentamos usar PowerShell para transferir[Powerup.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1)(un guión de PowerShell para enumerar los vectores de escalada de privilegios), pero PowerShell está bloqueado por el[Política de control de aplicaciones](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/windows-defender-application-control). Realizamos nuestra enumeración local manualmente y encontramos que tenemos[Seimpersonateprivilege](https://docs.microsoft.com/en-us/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege). Necesitamos transferir un binario a nuestra máquina objetivo para aumentar los privilegios utilizando el[Printspoofer](https://github.com/itm4n/PrintSpoofer)herramienta. Luego intentamos usar[Certutil](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil)Para descargar el archivo, nos compilamos directamente de nuestro propio GitHub, pero la organización tiene un fuerte filtrado de contenido web. No podemos acceder a sitios web como GitHub, Dropbox, Google Drive, etc., que se pueden usar para transferir archivos. A continuación, configuramos un servidor FTP e intentamos usar el cliente FTP de Windows para transferir archivos, pero el firewall de red bloqueó el tráfico de salida para el puerto 21 (TCP). Intentamos usar el[Smbserver](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py)Herramienta para crear una carpeta, y encontramos que se permitía el tráfico saliente al puerto TCP 445 (SMB). Utilizamos este método de transferencia de archivos para copiar con éxito el binario en nuestra máquina de destino y lograr nuestro objetivo de aumentar los privilegios a un usuario a nivel de administrador.

Comprender diferentes formas de realizar transferencias de archivos y cómo operan las redes puede ayudarnos a lograr nuestros objetivos durante una evaluación. Debemos ser conscientes de los controles de host que pueden evitar nuestras acciones, como la lista blanca de aplicaciones o AV/EDR bloqueando aplicaciones o actividades específicas. Las transferencias de archivos también se ven afectadas por dispositivos de red como firewalls, IDS o IP que pueden monitorear o bloquear puertos particulares o operaciones poco comunes.

La transferencia de archivos es una característica central de cualquier sistema operativo, y existen muchas herramientas para lograr esto. Sin embargo, muchas de estas herramientas pueden ser bloqueadas o monitoreadas por administradores diligentes, y vale la pena revisar una variedad de técnicas que pueden ser posibles en un entorno determinado.

Este módulo cubre técnicas que aprovechan las herramientas y aplicaciones comúnmente disponibles en los sistemas Windows y Linux. La lista de técnicas no es exhaustiva. La información dentro de este módulo también se puede utilizar como guía de referencia cuando se trabaja a través de otros módulos de la Academia HTB, ya que muchos de los ejercicios en el módulo nos exigirán transferir archivos a/desde un host de destino o a/desde el Pwnbox proporcionado. Se proporcionan ventanas de destino y máquinas Linux para completar algunos ejercicios prácticos como parte del módulo. Vale la pena utilizar estos objetivos para experimentar con tantas técnicas demostradas en las secciones del módulo como sea posible. Observe los matices entre los diferentes métodos de transferencia y anote situaciones en las que serían útiles. Una vez que haya completado este módulo, pruebe las div