# The Threat Hunting Process

A continuación se muestra una breve descripción del proceso de búsqueda de amenazas:

- `Setting the Stage`: La fase inicial tiene que ver con la planificación y la preparación. Incluye establecer objetivos claros basados ​​en una comprensión profunda del panorama de amenazas, los requisitos críticos de nuestro negocio y nuestros conocimientos de inteligencia sobre amenazas. La fase de preparación también incluye garantizar que nuestro entorno esté listo para una búsqueda eficaz de amenazas, lo que podría implicar permitir un registro extenso en nuestros sistemas y garantizar que las herramientas de búsqueda de amenazas, como SIEM, EDR e IDS, estén configuradas correctamente. Además, nos mantenemos informados sobre las ciberamenazas más recientes y nos familiarizamos con los perfiles de los actores de amenazas.
    - `Example`: Durante la fase de planificación y preparación, un equipo de búsqueda de amenazas podría realizar una investigación en profundidad sobre los últimos informes de inteligencia de amenazas, analizar vulnerabilidades específicas de la industria y estudiar las tácticas, técnicas y procedimientos (TTP) empleados por los actores de amenazas. También pueden identificar activos y sistemas críticos dentro de la organización que tienen más probabilidades de ser atacados. Como parte de la preparación, se pueden implementar amplios mecanismos de registro en servidores, dispositivos de red y puntos finales para capturar datos relevantes para su análisis. Las herramientas de búsqueda de amenazas como SIEM, EDR e IDS están configuradas para recopilar y correlacionar registros, generar alertas y brindar visibilidad de posibles incidentes de seguridad. Además, el equipo se mantiene actualizado sobre las amenazas cibernéticas emergentes al monitorear las fuentes de amenazas, suscribirse a listas de correo de seguridad relevantes y participar en comunidades de intercambio de información.
- `Formulating Hypotheses`: El siguiente paso consiste en hacer predicciones fundamentadas que guiarán nuestro viaje de búsqueda de amenazas. Estas hipótesis pueden surgir de diversas fuentes, como información reciente sobre amenazas, actualizaciones de la industria, alertas de herramientas de seguridad o incluso nuestra intuición profesional. Nos esforzamos por hacer que estas hipótesis sean comprobables para guiarnos dónde buscar y qué buscar.
    - `Example`: Una hipótesis podría ser que un atacante haya obtenido acceso a la red explotando una vulnerabilidad particular o mediante correos electrónicos de phishing. Esta hipótesis podría derivarse de informes recientes de inteligencia sobre amenazas que destacan vectores de ataque similares. También podría basarse en una alerta activada por un sistema de detección de intrusos que indique patrones de tráfico de red sospechosos. La hipótesis debe ser específica y comprobable, como por ejemplo "Un grupo de amenazas persistentes avanzadas (APT) está aprovechando una vulnerabilidad conocida en el servidor web de la organización para establecer un canal de comando y control (C2)".
- `Designing the Hunt`: Al elaborar una hipótesis, necesitamos desarrollar una estrategia de caza. Esto incluye reconocer las fuentes de datos específicas que necesitan análisis, las metodologías y herramientas que usaremos, y los indicadores de compromiso (IoC) particulares o patrones que buscaremos. En este punto, también podríamos crear scripts o consultas personalizados y utilizar herramientas dedicadas a la búsqueda de amenazas.
    - `Example`: El equipo de búsqueda de amenazas puede decidir analizar los registros del servidor web, los registros de tráfico de red, los registros de DNS o los datos de telemetría de los terminales. Definen las consultas de búsqueda, los filtros y las reglas de correlación para extraer información relevante de los datos recopilados. El equipo también aprovecha los feeds de inteligencia de amenazas y la inteligencia de código abierto (OSINT) para identificar indicadores específicos de compromiso (IoC) asociados con el actor de amenaza sospechoso o las técnicas de ataque conocidas. Esto puede implicar la elaboración de scripts o consultas personalizados para buscar IoC o el uso de plataformas especializadas de búsqueda de amenazas que automaticen el proceso.
- `Data Gathering and Examination`: Esta fase es donde ocurre la búsqueda activa de amenazas. Implica recopilar los datos necesarios, como archivos de registro, datos de tráfico de red, datos de terminales y luego analizar estos datos utilizando metodologías y herramientas predeterminadas. Nuestro objetivo es encontrar evidencia que apoye o refute nuestra hipótesis inicial. Esta fase es altamente iterativa y posiblemente implique el refinamiento de la hipótesis o el enfoque de investigación a medida que descubrimos nueva información.
    - `Example`: El equipo de búsqueda de amenazas puede examinar los registros de acceso al servidor web para identificar patrones de acceso inusuales o no autorizados, analizar capturas de tráfico de red para detectar comunicaciones sospechosas con dominios externos o investigar registros de puntos finales para identificar comportamientos anómalos o signos de compromiso. Aplican técnicas de análisis de datos como análisis estadístico, análisis de comportamiento o detección basada en firmas para identificar amenazas potenciales. Podrían emplear herramientas como analizadores de registros, analizadores de paquetes o entornos limitados de malware para extraer información de los datos recopilados y descubrir indicadores ocultos de compromiso.
- `Evaluating Findings and Testing Hypotheses`: Después de analizar los datos, necesitamos interpretar los resultados. Esto podría implicar confirmar o refutar la hipótesis, comprender el comportamiento de cualquier amenaza detectada, identificar los sistemas afectados o determinar el impacto potencial de la amenaza. Esta fase es crucial, ya que informará los próximos pasos en términos de respuesta y remediación.
    - `Example`: El equipo de búsqueda de amenazas podría descubrir una serie de intentos fallidos de inicio de sesión desde una dirección IP asociada con un actor de amenazas conocido, lo que confirma la hipótesis de un intento de ataque de fuerza bruta a las credenciales. También podrían encontrar evidencia de conexiones de red salientes sospechosas a dominios maliciosos conocidos, lo que respalda la hipótesis de un canal de comunicación de comando y control (C2). El equipo lleva a cabo investigaciones más profundas para comprender el comportamiento de las amenazas identificadas, evaluar el alcance del compromiso y determinar el impacto potencial en los sistemas y datos de la organización.
- `Mitigating Threats`: If we confirm a threat, we must undertake remediation actions. This could involve isolating affected systems, eliminating malware, patching vulnerabilities, or modifying configurations. Our goal is to eradicate the threat and limit any potential damage.
    - `Example`: Si el equipo de búsqueda de amenazas identifica un sistema comprometido que se comunica con un servidor C2, pueden aislar el sistema afectado de la red para evitar una mayor filtración de datos o daños. Pueden implementar herramientas de protección de terminales para eliminar malware o realizar análisis forenses en el sistema comprometido para recopilar evidencia adicional y determinar el alcance de la infracción. Las vulnerabilidades identificadas durante el proceso de búsqueda de amenazas se pueden parchear o mitigar para evitar futuros ataques. Las configuraciones de red se pueden ajustar para restringir el acceso no autorizado o fortalecer los controles de seguridad.
- `After the Hunt`: Una vez que concluye el ciclo de búsqueda de amenazas, es fundamental documentar y compartir los hallazgos, métodos y resultados. Esto podría implicar actualizar las plataformas de inteligencia de amenazas, mejorar las reglas de detección, perfeccionar los manuales de respuesta a incidentes o mejorar las políticas de seguridad. También es vital aprender de cada misión de búsqueda de amenazas para mejorar los esfuerzos futuros.
    - `Example`: Una vez que concluye el ciclo de búsqueda de amenazas, el equipo documenta los hallazgos, las metodologías y los resultados de la investigación. Actualizan las plataformas de inteligencia de amenazas con indicadores de compromiso (IoC) recientemente descubiertos y comparten información relevante con otros equipos o socios externos para mejorar la defensa colectiva contra las amenazas. Pueden mejorar las reglas de detección dentro de las herramientas de seguridad en función de los patrones de ataque observados y perfeccionar los manuales de respuesta a incidentes para agilizar el manejo de incidentes futuros. Las lecciones aprendidas de la búsqueda se incorporan a las políticas y procedimientos de seguridad, y los programas de capacitación se ajustan para mejorar la postura general de seguridad de la organización.
- `Continuous Learning and Enhancement`: La búsqueda de amenazas no es una tarea única, sino un proceso continuo de aprendizaje y perfeccionamiento. Cada ciclo de búsqueda de amenazas debe alimentar al siguiente, permitiendo la mejora continua de hipótesis, metodologías y herramientas basadas en el panorama de amenazas en evolución y el perfil de riesgo cambiante de la organización.
    - `Example`: Después de cada ciclo de búsqueda de amenazas, el equipo revisa la efectividad de sus hipótesis, metodologías y herramientas. Analizan los resultados y ajustan su enfoque en función de las lecciones aprendidas y la nueva inteligencia sobre amenazas. Por ejemplo, podrían mejorar sus técnicas de caza incorporando algoritmos de aprendizaje automático o análisis de comportamiento para detectar amenazas más sofisticadas. Participan en conferencias de la industria, asisten a sesiones de capacitación y colaboran con otros equipos de caza de amenazas para mantenerse actualizados sobre las últimas técnicas de ataque y estrategias defensivas.

La caza de amenazas es un delicado equilibrio entre arte y ciencia. Exige destreza técnica, creatividad y una comprensión profunda tanto del entorno de la organización como del panorama de amenazas más amplio. Los equipos de caza de amenazas más exitosos son aquellos que aprenden de cada caza y perfeccionan constantemente sus habilidades y procesos.

---

# **El proceso de búsqueda de amenazas versus Emotet**

Veamos cómo se podría haber aplicado el proceso de búsqueda de amenazas antes mencionado para buscar [malware de emoticones](https://www.cisa.gov/news-events/cybersecurity-advisories/aa20-280a) dentro de una organización.

- `Setting the Stage`: Durante la fase de planificación y preparación, el equipo de búsqueda de amenazas investiga exhaustivamente las tácticas, técnicas y procedimientos (TTP) del malware Emotet mediante el estudio de campañas de ataque anteriores, el análisis de muestras de malware y la revisión de informes de inteligencia de amenazas específicos de Emotet. Obtienen un conocimiento profundo de los vectores de infección de Emotet, como archivos adjuntos o enlaces de correo electrónico maliciosos, y la explotación de vulnerabilidades en software o sistemas operativos. El equipo identifica activos y sistemas críticos a los que Emotet suele apuntar, como terminales con privilegios administrativos o servidores de correo electrónico.
- `Formulating Hypotheses`: Las hipótesis en el contexto de la búsqueda de amenazas de Emotet podrían basarse en IoC de Emotet conocidos o en patrones observados en ataques anteriores. Por ejemplo, una hipótesis podría ser que Emotet esté utilizando una nueva técnica de phishing para distribuir cargas maliciosas a través de cuentas de correo electrónico comprometidas. Esta hipótesis podría derivarse de informes recientes de inteligencia sobre amenazas que destacan campañas similares de Emotet o basarse en alertas activadas por sistemas de seguridad de correo electrónico que detectan archivos adjuntos sospechosos. La hipótesis debe ser específica, como "Emotet está utilizando cuentas de correo electrónico comprometidas para enviar correos electrónicos de phishing con documentos de Word maliciosos que contienen macros".
- `Designing the Hunt`: En la fase de diseño, el equipo de caza de amenazas determina las fuentes de datos relevantes y los métodos de recopilación para validar o invalidar las hipótesis relacionadas con Emotet. Es posible que decidan analizar los registros del servidor de correo electrónico, los registros de tráfico de la red, los registros de los terminales o muestras de malware en el espacio aislado. Definen consultas de búsqueda, filtros y reglas de correlación para extraer información relacionada con las características específicas de Emotet, como líneas de asunto de correo electrónico, tipos de archivos adjuntos o patrones de comunicación de red asociados con infecciones de Emotet. Aprovechan los feeds de inteligencia de amenazas para identificar IoC relacionados con Emotet, como direcciones conocidas de servidores de comando y control (C2) o hashes de archivos asociados con las cargas útiles de Emotet.
- `Data Gathering and Examination`: Durante la fase activa de búsqueda de amenazas, el equipo recopila y analiza datos de diversas fuentes para detectar actividades relacionadas con Emotet. Por ejemplo, podrían examinar los registros del servidor de correo electrónico para identificar patrones de archivos adjuntos de correo electrónico sospechosos o analizar capturas de tráfico de red para detectar comunicaciones con servidores Emotet C2 conocidos. Aplican técnicas de análisis de datos, como análisis de encabezados de correo electrónico, análisis de patrones de tráfico de red o análisis de comportamiento, para identificar posibles infecciones de Emotet. Utilizan herramientas como software forense de correo electrónico, analizadores de paquetes de red o entornos sandbox para extraer información relevante de los datos recopilados y descubrir indicadores ocultos de la actividad de Emotet.
- `Evaluating Findings and Testing Hypotheses`: En esta fase, el equipo evalúa los hallazgos del análisis de datos para confirmar o refutar las hipótesis iniciales relacionadas con Emotet. Por ejemplo, podrían descubrir una serie de correos electrónicos con líneas de asunto y tipos de archivos adjuntos similares asociados con campañas de Emotet, lo que confirma la hipótesis de actividades de phishing en curso de Emotet. También podrían encontrar evidencia de conexiones de red a servidores Emotet C2 conocidos, lo que respalda la hipótesis de una infección activa de Emotet. El equipo lleva a cabo investigaciones más profundas para comprender el comportamiento de las infecciones de Emotet identificadas, evaluar el alcance del compromiso y determinar el impacto potencial en los sistemas y datos de la organización.
- `Mitigating Threats`: Si se confirman las infecciones de Emotet, el equipo toma medidas correctivas inmediatas. Aíslan los sistemas afectados de la red para evitar una mayor propagación del malware y una posible filtración de datos. Implementan herramientas de protección de terminales para detectar y eliminar el malware Emotet de los sistemas comprometidos. Además, analizan cuentas de correo electrónico comprometidas para identificar y eliminar el acceso no autorizado. Parchan o mitigan las vulnerabilidades explotadas por Emotet para prevenir futuras infecciones. Las configuraciones de red se ajustan para bloquear la comunicación con servidores Emotet C2 conocidos o dominios maliciosos.
- `After the Hunt`: Una vez que concluye el ciclo de búsqueda de amenazas de Emotet, el equipo documenta sus hallazgos, metodologías y resultados. Actualizan las plataformas de inteligencia de amenazas con nuevos IoC relacionados con Emotet y comparten información relevante con otros equipos o socios externos para mejorar su defensa colectiva contra Emotet. Mejoran las reglas de detección dentro de las herramientas de seguridad basadas en los patrones de ataque observados de Emotet y perfeccionan los manuales de respuesta a incidentes para agilizar el manejo de incidentes futuros. Las lecciones aprendidas de la búsqueda de Emotet se incorporan a las políticas y procedimientos de seguridad, y los programas de capacitación se ajustan para mejorar las defensas generales de la organización contra Emotet y malware similar.
- `Continuous Learning and Enhancement`: La búsqueda de amenazas para Emotet es un proceso continuo que requiere aprendizaje y mejora continuos. Después de cada ciclo de búsqueda de amenazas de Emotet, el equipo revisa la efectividad de sus hipótesis, metodologías y herramientas. Analizan los resultados y ajustan su enfoque en función de las lecciones aprendidas y la nueva inteligencia sobre amenazas relacionada con Emotet. Por ejemplo, podrían mejorar sus técnicas de caza incorporando mecanismos avanzados de detección basados ​​en el comportamiento o algoritmos de aprendizaje automático diseñados específicamente para identificar los TTP en evolución de Emotet. Participan activamente en conferencias de la industria, asisten a sesiones de capacitación y colaboran con otros equipos de caza de amenazas para mantenerse actualizados sobre las últimas técnicas de ataque y estrategias defensivas de Emotet.